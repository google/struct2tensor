
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>expression_impl - Struct2Tensor</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#expression_impl" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Struct2Tensor" class="md-header__button md-logo" aria-label="Struct2Tensor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Struct2Tensor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              expression_impl
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/google/struct2tensor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Struct2Tensor
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Struct2Tensor" class="md-nav__button md-logo" aria-label="Struct2Tensor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Struct2Tensor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/google/struct2tensor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Struct2Tensor
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/prensor_playground" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Your structured data into Tensorflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    s2t
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            s2t
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../s2t" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../s2t/s2t" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    s2t
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    expression_impl
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            expression_impl
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    expression_impl
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;expression_impl
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" expression_impl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.apply_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;apply_schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" apply_schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.apply_schema-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.apply_schema.apply_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;apply_schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.apply_schema-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.broadcast" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;broadcast
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" broadcast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.broadcast-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.broadcast.broadcast" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;broadcast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.broadcast.broadcast_anonymous" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;broadcast_anonymous
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.broadcast-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.depth_limit" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;depth_limit
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" depth_limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.depth_limit-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.depth_limit.limit_depth" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;limit_depth
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.depth_limit-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.filter_expression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;filter_expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" filter_expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.filter_expression-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.filter_expression.filter_by_child" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;filter_by_child
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.filter_expression.filter_by_sibling" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;filter_by_sibling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.filter_expression-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.index" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;index
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.index-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.index.get_index_from_end" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_index_from_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.index.get_positional_index" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_positional_index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.index-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;map_prensor
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" map_prensor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor.map_ragged_tensor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map_ragged_tensor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor.map_sparse_tensor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map_sparse_tensor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;map_prensor_to_prensor
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" map_prensor_to_prensor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor.create_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor.map_prensor_to_prensor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map_prensor_to_prensor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_prensor_to_prensor-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_values" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;map_values
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" map_values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_values-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_values.map_many_values" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map_many_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_values.map_values" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_values.map_values_anonymous" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;map_values_anonymous
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.map_values-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;parquet
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" parquet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet.ParquetDataset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ParquetDataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet.calculate_parquet_values" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calculate_parquet_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet.create_expression_from_parquet_file" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_expression_from_parquet_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parquet-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;parse_message_level_ex
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" parse_message_level_ex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ProtoFieldName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFullName" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ProtoFullName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex.StrStep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;StrStep
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex.get_full_name_from_any_step" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_full_name_from_any_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex.is_any_descriptor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;is_any_descriptor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex.parse_message_level_ex" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;parse_message_level_ex
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.parse_message_level_ex-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.placeholder" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;placeholder
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" placeholder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.placeholder-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.placeholder.create_expression_from_schema" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_expression_from_schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.placeholder.get_placeholder_paths_from_graph" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;get_placeholder_paths_from_graph
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.placeholder-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.project" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;project
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.project-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.project.project" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;project
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.project-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;promote
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" promote">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote.PromoteChildExpression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PromoteChildExpression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote.PromoteExpression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PromoteExpression
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote.promote" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;promote
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote.promote_anonymous" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;promote_anonymous
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote_and_broadcast" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;promote_and_broadcast
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" promote_and_broadcast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote_and_broadcast-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;promote_and_broadcast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast_anonymous" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;promote_and_broadcast_anonymous
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.promote_and_broadcast-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;proto
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" proto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.ProtoExpression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ProtoExpression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.ProtoFieldName" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ProtoFieldName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.ProtoFullName" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;ProtoFullName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.StrStep" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;StrStep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.TransformFn" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;TransformFn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.create_expression_from_file_descriptor_set" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_expression_from_file_descriptor_set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.create_expression_from_proto" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_expression_from_proto
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.create_transformed_field" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_transformed_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto.is_proto_expression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;is_proto_expression
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.proto-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.reroot" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;reroot
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" reroot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.reroot-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.reroot.create_proto_index_field" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_proto_index_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.reroot.reroot" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;reroot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.reroot-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;size
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" size">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size.SizeExpression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;SizeExpression
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size.has" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;has
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size.size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size.size_anonymous" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;size_anonymous
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.size-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.slice_expression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;slice_expression
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" slice_expression">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.slice_expression-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.slice_expression.IndexValue" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;IndexValue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.slice_expression-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.slice_expression.slice_expression" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;slice_expression
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct2tensor.expression_impl.slice_expression-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/google/struct2tensor/edit/master/docs/api_docs/python/expression_impl/expression_impl.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="expression_impl"><code>expression_impl</code><a class="headerlink" href="#expression_impl" title="Permanent link">¶</a></h1>


<div class="doc doc-object doc-module">



<h2 id="struct2tensor.expression_impl" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">struct2tensor.expression_impl</span>


<a href="#struct2tensor.expression_impl" class="headerlink" title="Permanent link">¶</a></h2>

    <div class="doc doc-contents first">

        <p>Import all modules in expression_impl.</p>
<p>The modules in this file should be accessed like the following:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">struct2tensor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">s2t</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">struct2tensor</span><span class="w"> </span><span class="kn">import</span> <span class="n">expression_impl</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">s2t</span><span class="o">.</span><span class="n">expression_impl</span><span class="o">.</span><span class="n">apply_schema</span>
</span></code></pre></div>






<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">MODULE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            apply_schema (struct2tensor.expression_impl.apply_schema)" href="#struct2tensor.expression_impl.apply_schema">apply_schema</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Apply a schema to an expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            broadcast (struct2tensor.expression_impl.broadcast)" href="#struct2tensor.expression_impl.broadcast">broadcast</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Methods for broadcasting a path in a tree.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            depth_limit (struct2tensor.expression_impl.depth_limit)" href="#struct2tensor.expression_impl.depth_limit">depth_limit</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Caps the depth of an expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            filter_expression (struct2tensor.expression_impl.filter_expression)" href="#struct2tensor.expression_impl.filter_expression">filter_expression</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Create a new expression that is a filtered version of an original one.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            index (struct2tensor.expression_impl.index)" href="#struct2tensor.expression_impl.index">index</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>get_positional_index and get_index_from_end methods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            map_prensor (struct2tensor.expression_impl.map_prensor)" href="#struct2tensor.expression_impl.map_prensor">map_prensor</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Arbitrary operations from sparse and ragged tensors to a leaf field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            map_prensor_to_prensor (struct2tensor.expression_impl.map_prensor_to_prensor)" href="#struct2tensor.expression_impl.map_prensor_to_prensor">map_prensor_to_prensor</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Arbitrary operations from prensors to prensors in an expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            map_values (struct2tensor.expression_impl.map_values)" href="#struct2tensor.expression_impl.map_values">map_values</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Maps the values of various leaves of the same child to a single result.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            parquet (struct2tensor.expression_impl.parquet)" href="#struct2tensor.expression_impl.parquet">parquet</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Apache Parquet Dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            parse_message_level_ex (struct2tensor.expression_impl.parse_message_level_ex)" href="#struct2tensor.expression_impl.parse_message_level_ex">parse_message_level_ex</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Parses regular fields, extensions, any casts, and map protos.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            placeholder (struct2tensor.expression_impl.placeholder)" href="#struct2tensor.expression_impl.placeholder">placeholder</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Placeholder expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            project (struct2tensor.expression_impl.project)" href="#struct2tensor.expression_impl.project">project</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>project selects a subtree of an expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            promote (struct2tensor.expression_impl.promote)" href="#struct2tensor.expression_impl.promote">promote</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Promote an expression to be a child of its grandparent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            promote_and_broadcast (struct2tensor.expression_impl.promote_and_broadcast)" href="#struct2tensor.expression_impl.promote_and_broadcast">promote_and_broadcast</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>promote_and_broadcast a set of nodes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            proto (struct2tensor.expression_impl.proto)" href="#struct2tensor.expression_impl.proto">proto</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Expressions to parse a proto.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            reroot (struct2tensor.expression_impl.reroot)" href="#struct2tensor.expression_impl.reroot">reroot</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Reroot to a subtree, maintaining an input proto index.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            size (struct2tensor.expression_impl.size)" href="#struct2tensor.expression_impl.size">size</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Functions for creating new size or has expression.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            slice_expression (struct2tensor.expression_impl.slice_expression)" href="#struct2tensor.expression_impl.slice_expression">slice_expression</a></code></td>
            <td class="doc-module-details">
              <div class="doc-md-description">
                <p>Implementation of slice.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>









  <div class="doc doc-children">








<h3 id="struct2tensor.expression_impl-modules">Modules<a href="#struct2tensor.expression_impl-modules" class="headerlink" title="Permanent link">¶</a></h3>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.apply_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">apply_schema</span>


<a href="#struct2tensor.expression_impl.apply_schema" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Apply a schema to an expression.</p>
<p>A tensorflow metadata schema (TODO(martinz): link) represents more
detailed information about the data: specifically, it presents domain
information (e.g., not just integers, but integers between 0 and 10), and more
detailed structural information (e.g., this field occurs in at least 70% of its
parents, and when it occurs, it shows up 5 to 7 times).</p>
<p>Applying a schema attaches a tensorflow metadata schema to an expression:
namely, it aligns the features in the schema with the expression's children by
name (possibly recursively).</p>
<p>After applying a schema to an expression, one can use promote, broadcast, et
cetera, and the schema for new expressions will be inferred. If you write a
custom expression, you can write code that determines the schema information of
the result.</p>
<p>To get the schema back, call get_schema().</p>
<p>This does not filter out fields not in the schema.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">my_expr</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">my_schema</span> <span class="o">=</span> <span class="c1"># ...schema here...</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">my_new_schema</span> <span class="o">=</span> <span class="n">my_expr</span><span class="o">.</span><span class="n">apply_schema</span><span class="p">(</span><span class="n">my_schema</span><span class="p">)</span><span class="o">.</span><span class="n">get_schema</span><span class="p">()</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># my_new_schema has semantically identical information on the fields as my_schema.</span>
</span></code></pre></div>
<p>TODO(martinz): Add utilities to:</p>
<ol>
<li>Get the (non-deprecated) paths from a schema.</li>
<li>Check if any paths in the schema are not in the expression.</li>
<li>Check if any paths in the expression are not in the schema.</li>
<li>Project the expression to paths in the schema.</li>
</ol>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply_schema (struct2tensor.expression_impl.apply_schema.apply_schema)" href="#struct2tensor.expression_impl.apply_schema.apply_schema">apply_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.apply_schema-functions">Functions<a href="#struct2tensor.expression_impl.apply_schema-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.apply_schema.apply_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">apply_schema</span>


<a href="#struct2tensor.expression_impl.apply_schema.apply_schema" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_schema</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/apply_schema.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_schema</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>                 <span class="n">schema</span><span class="p">:</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>  <span class="n">schema_copy</span> <span class="o">=</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>  <span class="n">schema_copy</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>  <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">schema_copy</span><span class="o">.</span><span class="n">feature</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">_normalize_feature</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">schema_copy</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>  <span class="k">return</span> <span class="n">_SchemaExpression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">schema_copy</span><span class="o">.</span><span class="n">feature</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.apply_schema-modules">Modules<a href="#struct2tensor.expression_impl.apply_schema-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">broadcast</span>


<a href="#struct2tensor.expression_impl.broadcast" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Methods for broadcasting a path in a tree.</p>
<p>This provides methods for broadcasting a field anonymously (that is used in
promote_and_broadcast), or with an explicitly given name.</p>
<p>Suppose you have an expr representing:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>+
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>|
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>+-session*   (stars indicate repeated)
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>     |
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>     +-event*
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>     |
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>     +-val*-int64
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">}</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">broadcast</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"session"</span><span class="p">,</span><span class="s2">"val"</span><span class="p">]),</span> <span class="s2">"event"</span><span class="p">,</span> <span class="s2">"nv"</span><span class="p">)</span>
</span></code></pre></div>
<p>becomes:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>+
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>|
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>+---session*   (stars indicate repeated)
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>       |
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>       +-event*
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>       |   |
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>       |   +---nv*-int64
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>       |
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>       +-val*-int64
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="kc">n</span><span class="err">v</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="kc">n</span><span class="err">v</span><span class="p">:</span><span class="mi">11</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="kc">n</span><span class="err">v</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="kc">n</span><span class="err">v</span><span class="p">:</span><span class="mi">11</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">}</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="kc">n</span><span class="err">v</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">}</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="kc">n</span><span class="err">v</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="p">}</span>
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            broadcast (struct2tensor.expression_impl.broadcast.broadcast)" href="#struct2tensor.expression_impl.broadcast.broadcast">broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            broadcast_anonymous (struct2tensor.expression_impl.broadcast.broadcast_anonymous)" href="#struct2tensor.expression_impl.broadcast.broadcast_anonymous">broadcast_anonymous</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.broadcast-functions">Functions<a href="#struct2tensor.expression_impl.broadcast-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.broadcast.broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">broadcast</span>


<a href="#struct2tensor.expression_impl.broadcast.broadcast" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">sibling_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/broadcast.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="k">def</span><span class="w"> </span><span class="nf">broadcast</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a>              <span class="n">sibling_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a>              <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a>  <span class="k">return</span> <span class="n">_broadcast_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">sibling_name</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.broadcast.broadcast_anonymous" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">broadcast_anonymous</span>


<a href="#struct2tensor.expression_impl.broadcast.broadcast_anonymous" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">broadcast_anonymous</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n">sibling</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/broadcast.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="k">def</span><span class="w"> </span><span class="nf">broadcast_anonymous</span><span class="p">(</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="n">sibling</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>  <span class="k">return</span> <span class="n">_broadcast_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">sibling</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">get_anonymous_field</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.broadcast-modules">Modules<a href="#struct2tensor.expression_impl.broadcast-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.depth_limit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">depth_limit</span>


<a href="#struct2tensor.expression_impl.depth_limit" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Caps the depth of an expression.</p>
<p>Suppose you have an expression expr modeled as:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>  *
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>   \
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    A
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>   / \
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  D   B
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>       \
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        C
</span></code></pre></div>
<p>if expr_2 = depth_limit.limit_depth(expr, 2)
You get:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>  *
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>   \
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    A
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>   / \
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>  D   B
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            limit_depth (struct2tensor.expression_impl.depth_limit.limit_depth)" href="#struct2tensor.expression_impl.depth_limit.limit_depth">limit_depth</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Limit the depth to nodes k steps from expr.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.depth_limit-functions">Functions<a href="#struct2tensor.expression_impl.depth_limit-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.depth_limit.limit_depth" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">limit_depth</span>


<a href="#struct2tensor.expression_impl.depth_limit.limit_depth" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">limit_depth</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">depth_limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Limit the depth to nodes k steps from expr.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/depth_limit.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="k">def</span><span class="w"> </span><span class="nf">limit_depth</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="n">depth_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">  </span><span class="sd">"""Limit the depth to nodes k steps from expr."""</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>  <span class="k">return</span> <span class="n">_DepthLimitExpression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">depth_limit</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.depth_limit-modules">Modules<a href="#struct2tensor.expression_impl.depth_limit-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.filter_expression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">filter_expression</span>


<a href="#struct2tensor.expression_impl.filter_expression" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Create a new expression that is a filtered version of an original one.</p>
<p>There are two public methods in this module: filter_by_sibling and
filter_by_child. As with most other operations, these create a new tree which
has all the original paths of the original tree, but with a new subtree.</p>
<p>filter_by_sibling allows you to filter an expression by a boolean sibling field.</p>
<p>Beginning with the struct:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>root =
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>         -----*----------------------------------------------------
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        /                       \                                  \
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>     root0                    root1-----------------------      root2 (empty)
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>      /   \                   /    \               \      \
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>      |  keep_my_sib0:False  |  keep_my_sib1:True   | keep_my_sib2:False
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    doc0-----               doc1---------------    doc2--------
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>     |       \                \           \    \               \
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    bar:"a"  keep_me:False    bar:"b" bar:"c" keep_me:True      bar:"d"
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a># Note, keep_my_sib and doc must have the same shape (e.g., each root
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>has the same number of keep_my_sib children as doc children).
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>root_2 = filter_expression.filter_by_sibling(
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    root, path.create_path("doc"), "keep_my_sib", "new_doc")
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>End with the struct (suppressing original doc):
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>         -----*----------------------------------------------------
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        /                       \                                  \
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    root0                    root1------------------        root2 (empty)
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>        \                   /    \                  \
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>        keep_my_sib0:False  |  keep_my_sib1:True   keep_my_sib2:False
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>                           new_doc0-----------
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>                             \           \    \
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>                             bar:"b" bar:"c" keep_me:True
</span></code></pre></div>
<p>filter_by_sibling allows you to filter an expression by a optional boolean
child field.</p>
<p>The following call will have the same effect as above:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">root_2</span> <span class="o">=</span> <span class="n">filter_expression</span><span class="o">.</span><span class="n">filter_by_child</span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">root</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="s2">"doc"</span><span class="p">),</span> <span class="s2">"keep_me"</span><span class="p">,</span> <span class="s2">"new_doc"</span><span class="p">)</span>
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            filter_by_child (struct2tensor.expression_impl.filter_expression.filter_by_child)" href="#struct2tensor.expression_impl.filter_expression.filter_by_child">filter_by_child</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Filter an expression by an optional boolean child field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            filter_by_sibling (struct2tensor.expression_impl.filter_expression.filter_by_sibling)" href="#struct2tensor.expression_impl.filter_expression.filter_by_sibling">filter_by_sibling</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Filter an expression by its sibling.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.filter_expression-functions">Functions<a href="#struct2tensor.expression_impl.filter_expression-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.filter_expression.filter_by_child" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">filter_by_child</span>


<a href="#struct2tensor.expression_impl.filter_expression.filter_by_child" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">filter_by_child</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">child_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter an expression by an optional boolean child field.</p>
<p>If the child field is present and True, then keep that parent.
Otherwise, drop the parent.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original expression</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path to filter.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>child_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the boolean child field to use to filter.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the new, filtered version of path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new root expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/filter_expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_child</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>                    <span class="n">child_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>                    <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">  </span><span class="sd">"""Filter an expression by an optional boolean child field.</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">  If the child field is present and True, then keep that parent.</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">  Otherwise, drop the parent.</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">  Args:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    expr: the original expression</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    p: the path to filter.</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    child_field_name: the boolean child field to use to filter.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    new_field_name: the new, filtered version of path.</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    The new root expression.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">  """</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>  <span class="n">origin</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>  <span class="n">child</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">get_child_or_error</span><span class="p">(</span><span class="n">child_field_name</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>  <span class="n">new_expr</span> <span class="o">=</span> <span class="n">_FilterByChildExpression</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>  <span class="n">new_path</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">{</span><span class="n">new_path</span><span class="p">:</span> <span class="n">new_expr</span><span class="p">})</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.filter_expression.filter_by_sibling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">filter_by_sibling</span>


<a href="#struct2tensor.expression_impl.filter_expression.filter_by_sibling" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">filter_by_sibling</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">sibling_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter an expression by its sibling.</p>
<p>This is similar to boolean_mask. The shape of the path being filtered and
the sibling must be identical (e.g., each parent object must have an
equal number of source and sibling children).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the root expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a path to the source to be filtered.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sibling_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the sibling to use as a mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a new sibling to create.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a new root.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/filter_expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span>
<span class="normal"><a href="#__codelineno-0-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">filter_by_sibling</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>                      <span class="n">sibling_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>                      <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">  </span><span class="sd">"""Filter an expression by its sibling.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">  This is similar to boolean_mask. The shape of the path being filtered and</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">  the sibling must be identical (e.g., each parent object must have an</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">  equal number of source and sibling children).</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">  Args:</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    expr: the root expression.</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    p: a path to the source to be filtered.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    sibling_field_name: the sibling to use as a mask.</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    new_field_name: a new sibling to create.</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    a new root.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">  """</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>  <span class="n">origin</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>  <span class="n">parent_path</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>  <span class="n">sibling</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>      <span class="n">parent_path</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">sibling_field_name</span><span class="p">))</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>  <span class="n">new_expr</span> <span class="o">=</span> <span class="n">_FilterBySiblingExpression</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">sibling</span><span class="p">)</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>  <span class="n">new_path</span> <span class="o">=</span> <span class="n">parent_path</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">{</span><span class="n">new_path</span><span class="p">:</span> <span class="n">new_expr</span><span class="p">})</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.filter_expression-modules">Modules<a href="#struct2tensor.expression_impl.filter_expression-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">index</span>


<a href="#struct2tensor.expression_impl.index" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>get_positional_index and get_index_from_end methods.</p>
<p>The parent_index identifies the index of the parent of each element. These
methods take the parent_index to determine the relationship with respect to
other elements.</p>
<p>Given:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">121</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">122</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">}</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">get_positional_index</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"event"</span><span class="p">,</span><span class="s2">"val"</span><span class="p">]),</span> <span class="s2">"val_index"</span><span class="p">)</span>
</span></code></pre></div>
<p>yields:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="err">val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">121</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">122</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="err">val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="err">val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="p">}</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="err">val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="err">val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="err">val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="p">}</span>
</span></code></pre></div>
<p></p><div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">get_index_from_end</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"event"</span><span class="p">,</span><span class="s2">"val"</span><span class="p">]),</span> <span class="s2">"neg_val_index"</span><span class="p">)</span>
</span></code></pre></div>
yields:
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="kc">ne</span><span class="err">g_val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">121</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">122</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="kc">ne</span><span class="err">g_val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="kc">ne</span><span class="err">g_val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">}</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">    </span><span class="kc">ne</span><span class="err">g_val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="kc">ne</span><span class="err">g_val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="kc">ne</span><span class="err">g_val_i</span><span class="kc">n</span><span class="err">dex</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="p">}</span>
</span></code></pre></div>
<p>These methods are useful when you want to depend upon the index of a field.
For example, if you want to filter examples based upon their index, or
cogroup two fields by index, then first creating the index is useful.</p>
<p>Note that while the parent indices of these fields seem like overhead, they
are just references to the parent indices of other fields, and are therefore
take little memory or CPU.</p>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_index_from_end (struct2tensor.expression_impl.index.get_index_from_end)" href="#struct2tensor.expression_impl.index.get_index_from_end">get_index_from_end</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets the number of steps from the end of the array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_positional_index (struct2tensor.expression_impl.index.get_positional_index)" href="#struct2tensor.expression_impl.index.get_positional_index">get_positional_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets the positional index.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.index-functions">Functions<a href="#struct2tensor.expression_impl.index-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.index.get_index_from_end" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_index_from_end</span>


<a href="#struct2tensor.expression_impl.index.get_index_from_end" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_index_from_end</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">t</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the number of steps from the end of the array.</p>
<p>Given an array ["a", "b", "c"], with indices [0, 1, 2], the result of this
is [-3,-2,-1].</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>original expression</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>path in expression to get index of.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>, <a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression and the new path as a pair.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/index.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_index_from_end</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">  </span><span class="sd">"""Gets the number of steps from the end of the array.</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">  Given an array ["a", "b", "c"], with indices [0, 1, 2], the result of this</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">  is [-3,-2,-1].</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">  Args:</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    t: original expression</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    source_path: path in expression to get index of.</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    new_field_name: the name of the new field.</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    The new expression and the new path as a pair.</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">  """</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>  <span class="n">new_path</span> <span class="o">=</span> <span class="n">source_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>  <span class="n">work_expr</span><span class="p">,</span> <span class="n">positional_index_path</span> <span class="o">=</span> <span class="n">get_positional_index</span><span class="p">(</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>      <span class="n">t</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">get_anonymous_field</span><span class="p">())</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>  <span class="n">work_expr</span><span class="p">,</span> <span class="n">size_path</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="n">size_anonymous</span><span class="p">(</span><span class="n">work_expr</span><span class="p">,</span> <span class="n">source_path</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>  <span class="n">work_expr</span> <span class="o">=</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>      <span class="n">work_expr</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>          <span class="n">new_path</span><span class="p">:</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>              <span class="n">_PositionalIndexFromEndExpression</span><span class="p">(</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>                  <span class="n">work_expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">positional_index_path</span><span class="p">),</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>                  <span class="n">work_expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">size_path</span><span class="p">))</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>      <span class="p">})</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>  <span class="c1"># Removing the intermediate anonymous nodes.</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{</span><span class="n">new_path</span><span class="p">:</span> <span class="n">work_expr</span><span class="p">})</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>  <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">new_path</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.index.get_positional_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_positional_index</span>


<a href="#struct2tensor.expression_impl.index.get_positional_index" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_positional_index</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the positional index.</p>
<p>Given a field with parent_index [0,1,1,2,3,4,4], this returns:
parent_index [0,1,1,2,3,4,4] and value [0,0,1,0,0,0,1]</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>original expression</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>path in expression to get index of.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>, <a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression and the new path as a pair.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/index.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_positional_index</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>                         <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">  </span><span class="sd">"""Gets the positional index.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">  Given a field with parent_index [0,1,1,2,3,4,4], this returns:</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">  parent_index [0,1,1,2,3,4,4] and value [0,0,1,0,0,0,1]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">  Args:</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    expr: original expression</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    source_path: path in expression to get index of.</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    new_field_name: the name of the new field.</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    The new expression and the new path as a pair.</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">  """</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>  <span class="n">new_path</span> <span class="o">=</span> <span class="n">source_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>      <span class="n">expr</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>          <span class="n">new_path</span><span class="p">:</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>              <span class="n">_PositionalIndexExpression</span><span class="p">(</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>                  <span class="n">expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">source_path</span><span class="p">))</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>      <span class="p">}),</span> <span class="n">new_path</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.index-modules">Modules<a href="#struct2tensor.expression_impl.index-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.map_prensor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">map_prensor</span>


<a href="#struct2tensor.expression_impl.map_prensor" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Arbitrary operations from sparse and ragged tensors to a leaf field.</p>
<p>There are two public methods of note right now: map_sparse_tensor
and map_ragged_tensor.</p>
<p>Assume expr is:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="err">val_a</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="err">val_b</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="err">val_a</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="err">val_b</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="err">val_a</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="err">val_b</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Either of the following alternatives will add val_a and val_b
to create val_sum.</p>
<p>map_sparse_tensor converts val_a and val_b to sparse tensors,
and then add them to produce val_sum.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">new_root</span> <span class="o">=</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_sparse_tensor</span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="n">expr</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"event"</span><span class="p">]),</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"val_a"</span><span class="p">]),</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"val_b"</span><span class="p">])],</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="s2">"val_sum"</span><span class="p">)</span>
</span></code></pre></div>
<p>map_ragged_tensor converts val_a and val_b to ragged tensors,
and then add them to produce val_sum.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">new_root</span> <span class="o">=</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_ragged_tensor</span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">expr</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"event"</span><span class="p">]),</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"val_a"</span><span class="p">]),</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"val_b"</span><span class="p">])],</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="s2">"val_sum"</span><span class="p">)</span>
</span></code></pre></div>
<p>The result of either is:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="err">val_a</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="err">val_b</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="err">val_sum</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="err">val_a</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="err">val_b</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="err">val_sum</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="err">val_a</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="err">val_sum</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="err">val_b</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="err">val_sum</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="p">}</span>
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_ragged_tensor (struct2tensor.expression_impl.map_prensor.map_ragged_tensor)" href="#struct2tensor.expression_impl.map_prensor.map_ragged_tensor">map_ragged_tensor</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map a ragged tensor.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_sparse_tensor (struct2tensor.expression_impl.map_prensor.map_sparse_tensor)" href="#struct2tensor.expression_impl.map_prensor.map_sparse_tensor">map_sparse_tensor</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a sparse tensor.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.map_prensor-functions">Functions<a href="#struct2tensor.expression_impl.map_prensor-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_prensor.map_ragged_tensor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">map_ragged_tensor</span>


<a href="#struct2tensor.expression_impl.map_prensor.map_ragged_tensor" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_ragged_tensor</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">root_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">paths</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">operation</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.RaggedTensor">RaggedTensor</span></span><span class="p">],</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map a ragged tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the root of the expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path relative to which the ragged tensors are calculated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>paths</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the input paths relative to the root_path</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a method that takes the list of ragged tensors as input and
returns a ragged tensor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.RaggedTensor">RaggedTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>true if the result of operation is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dtype of the result of the operation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>root_path.get_child(new_field_name) is the path of the
result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new root expression containing the old root expression plus the new path,
root_path.get_child(new_field_name), with the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_prensor.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_ragged_tensor</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">root_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>                      <span class="n">paths</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>                      <span class="n">operation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">RaggedTensor</span><span class="p">],</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>                      <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>                      <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="w">  </span><span class="sd">"""Map a ragged tensor.</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">  Args:</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    root: the root of the expression.</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    root_path: the path relative to which the ragged tensors are calculated.</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    paths: the input paths relative to the root_path</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    operation: a method that takes the list of ragged tensors as input and</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">      returns a ragged tensor.</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    is_repeated: true if the result of operation is repeated.</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    dtype: dtype of the result of the operation.</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    new_field_name: root_path.get_child(new_field_name) is the path of the</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">      result.</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    A new root expression containing the old root expression plus the new path,</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">      root_path.get_child(new_field_name), with the result of the operation.</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">  """</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>  <span class="k">return</span> <span class="n">_map_ragged_tensor_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>                                 <span class="n">dtype</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_prensor.map_sparse_tensor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">map_sparse_tensor</span>


<a href="#struct2tensor.expression_impl.map_prensor.map_sparse_tensor" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_sparse_tensor</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">root_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">paths</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">operation</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a sparse tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the root of the expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path relative to which the sparse tensors are calculated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>paths</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the input paths relative to the root_path</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a method that takes the list of sparse tensors as input and
returns a sparse tensor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>true if the result of operation is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dtype of the result of the operation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>root_path.get_child(new_field_name) is the path of the
result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new root expression containing the old root expression plus the new path,
root_path.get_child(new_field_name), with the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_prensor.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_sparse_tensor</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">root_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                      <span class="n">paths</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                      <span class="n">operation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>                      <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>                      <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">  </span><span class="sd">"""Maps a sparse tensor.</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">  Args:</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    root: the root of the expression.</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    root_path: the path relative to which the sparse tensors are calculated.</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    paths: the input paths relative to the root_path</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    operation: a method that takes the list of sparse tensors as input and</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">      returns a sparse tensor.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    is_repeated: true if the result of operation is repeated.</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    dtype: dtype of the result of the operation.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    new_field_name: root_path.get_child(new_field_name) is the path of the</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">      result.</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    A new root expression containing the old root expression plus the new path,</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">      root_path.get_child(new_field_name), with the result of the operation.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">  """</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>  <span class="k">return</span> <span class="n">_map_sparse_tensor_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>                                 <span class="n">dtype</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.map_prensor-modules">Modules<a href="#struct2tensor.expression_impl.map_prensor-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.map_prensor_to_prensor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">map_prensor_to_prensor</span>


<a href="#struct2tensor.expression_impl.map_prensor_to_prensor" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Arbitrary operations from prensors to prensors in an expression.</p>
<p>This is useful if a single op generates an entire structure. In general, it is
better to use the existing expressions framework or design a custom expression
than use this op. So long as any of the output is required, all of the input
is required.</p>
<p>For example, suppose you have an op my_op, that takes a prensor of the form:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>  event
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>   / \
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a> foo   bar
</span></code></pre></div>
<p>and produces a prensor of the form my_result_schema:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>   event
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    / \
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a> foo2 bar2
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">my_result_schema</span> <span class="o">=</span> <span class="n">create_schema</span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">is_repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s2">"foo2"</span><span class="p">:{</span><span class="n">is_repeated</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">},</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>              <span class="s2">"bar2"</span><span class="p">:{</span><span class="n">is_repeated</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">}})</span>
</span></code></pre></div>
<p>If you give it an expression original with the schema:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a> session
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    |
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  event
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>  /  \
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>foo   bar
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">result</span> <span class="o">=</span> <span class="n">map_prensor_to_prensor</span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  <span class="n">original</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"session"</span><span class="p">,</span><span class="s2">"event"</span><span class="p">]),</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  <span class="n">my_op</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  <span class="n">my_result_schema</span><span class="p">)</span>
</span></code></pre></div>
<p>Result will have the schema:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a> session
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    |
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  event--------
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  /  \    \    \
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>foo   bar foo2 bar2
</span></code></pre></div>








<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">CLASS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></code></td>
            <td class="doc-class-details">
              <div class="doc-md-description">
                <p>A finite schema for a prensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_schema (struct2tensor.expression_impl.map_prensor_to_prensor.create_schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.create_schema">create_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Create a schema recursively.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_prensor_to_prensor (struct2tensor.expression_impl.map_prensor_to_prensor.map_prensor_to_prensor)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.map_prensor_to_prensor">map_prensor_to_prensor</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps an expression to a prensor, and merges that prensor.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">






<h5 id="struct2tensor.expression_impl.map_prensor_to_prensor-classes">Classes<a href="#struct2tensor.expression_impl.map_prensor_to_prensor-classes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-class">



<h6 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Schema</span>


<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">Schema</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">schema_feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">children</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#object">object</a></code></p>


        <p>A finite schema for a prensor.</p>
<p>Effectively, this stores everything for the prensor but the tensors
themselves.</p>
<p>Notice that this is slightly different than schema_pb2.Schema, although
similar in nature. At present, there is no clear way to extract is_repeated
and dtype from schema_pb2.Schema.</p>
<p>See create_schema below for constructing a schema.</p>
<p>Note that for LeafNodeTensor, dtype is not None.
Also, for ChildNodeTensor and RootNodeTensor, dtype is None. However,
a ChildNodeTensor or RootNodeTensor could be childless.</p>

        <p>Create a new Schema object.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>is the root repeated?</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>tf.dtype of the root if the root is a leaf, otherwise None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_feature</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>schema_pb2.Feature of the root (no struct_domain
necessary)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>children</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>child schemas.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>, <a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child (struct2tensor.expression_impl.map_prensor_to_prensor.Schema.get_child)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.get_child">get_child</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            known_field_names (struct2tensor.expression_impl.map_prensor_to_prensor.Schema.known_field_names)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.known_field_names">known_field_names</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_repeated


  
      property
   (struct2tensor.expression_impl.map_prensor_to_prensor.Schema.is_repeated)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.is_repeated">is_repeated</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            schema_feature


  
      property
   (struct2tensor.expression_impl.map_prensor_to_prensor.Schema.schema_feature)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.schema_feature">schema_feature</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            type


  
      property
   (struct2tensor.expression_impl.map_prensor_to_prensor.Schema.type)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.type">type</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

                  <details class="quote">
                    <summary>Source code in <code>struct2tensor/expression_impl/map_prensor_to_prensor.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>             <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>             <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>             <span class="n">schema_feature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">schema_pb2</span><span class="o">.</span><span class="n">Feature</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>             <span class="n">children</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="s2">"Schema"</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">  </span><span class="sd">"""Create a new Schema object.</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">  Args:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    is_repeated: is the root repeated?</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    dtype: tf.dtype of the root if the root is a leaf, otherwise None.</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    schema_feature: schema_pb2.Feature of the root (no struct_domain</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">      necessary)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    children: child schemas.</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">  """</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_is_repeated</span> <span class="o">=</span> <span class="n">is_repeated</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">dtype</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_schema_feature</span> <span class="o">=</span> <span class="n">schema_feature</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="n">children</span> <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>  <span class="c1"># Cannot have a type and children.</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>  <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">





<h7 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema-attributes">Attributes<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema-attributes" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema.is_repeated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_repeated</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.is_repeated" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema.schema_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">schema_feature</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.schema_feature" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">schema_feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema.type" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">type</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.type" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h7 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema-functions">Functions<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema-functions" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema.get_child" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child</span>


<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.get_child" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_prensor_to_prensor.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">):</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.map_prensor_to_prensor.Schema.known_field_names" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">known_field_names</span>


<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema.known_field_names" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">known_field_names</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_prensor_to_prensor.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="k">def</span><span class="w"> </span><span class="nf">known_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenSet</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">]:</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>  <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h5 id="struct2tensor.expression_impl.map_prensor_to_prensor-functions">Functions<a href="#struct2tensor.expression_impl.map_prensor_to_prensor-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_prensor_to_prensor.create_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_schema</span>


<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.create_schema" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_schema</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">schema_feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">children</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a schema recursively.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">my_result_schema</span> <span class="o">=</span> <span class="n">create_schema</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  <span class="n">is_repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  <span class="n">children</span><span class="o">=</span><span class="p">{</span><span class="s2">"foo2"</span><span class="p">:{</span><span class="n">is_repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">},</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>            <span class="s2">"bar2"</span><span class="p">:{</span><span class="n">is_repeated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">}})</span>
</span></code></pre></div>
</div>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the root is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of a leaf (None for non-leaves).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_feature</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the schema_pb2.Feature describing this expression. name and
struct_domain need not be specified.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>children</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the child schemas. Note that the value type of children is either
a Schema or a dictionary of arguments to create_schema.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a new Schema represented by the inputs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_prensor_to_prensor.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_schema</span><span class="p">(</span><span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>                  <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>                  <span class="n">schema_feature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">schema_pb2</span><span class="o">.</span><span class="n">Feature</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>                  <span class="n">children</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Schema</span><span class="p">:</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">  </span><span class="sd">"""Create a schema recursively.</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">  !!! Example</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">      ```python</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">      my_result_schema = create_schema(</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        is_repeated=True,</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        children={"foo2":{is_repeated=True, dtype=tf.int64},</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">                  "bar2":{is_repeated=False, dtype=tf.int64}})</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">      ```</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">  Args:</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    is_repeated: whether the root is repeated.</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    dtype: the dtype of a leaf (None for non-leaves).</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    schema_feature: the schema_pb2.Feature describing this expression. name and</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">      struct_domain need not be specified.</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    children: the child schemas. Note that the value type of children is either</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">      a Schema or a dictionary of arguments to create_schema.</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    a new Schema represented by the inputs.</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">  """</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>  <span class="n">children_dict</span> <span class="o">=</span> <span class="n">children</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>  <span class="n">child_schemas</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>      <span class="n">k</span><span class="p">:</span> <span class="n">_create_schema_helper</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">children_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>  <span class="p">}</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>  <span class="k">return</span> <span class="n">Schema</span><span class="p">(</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>      <span class="n">is_repeated</span><span class="o">=</span><span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>      <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>      <span class="n">schema_feature</span><span class="o">=</span><span class="n">schema_feature</span><span class="p">,</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>      <span class="n">children</span><span class="o">=</span><span class="n">child_schemas</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_prensor_to_prensor.map_prensor_to_prensor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">map_prensor_to_prensor</span>


<a href="#struct2tensor.expression_impl.map_prensor_to_prensor.map_prensor_to_prensor" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_prensor_to_prensor</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root_expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">paths_needed</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">prensor_op</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a></span><span class="p">],</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">output_schema</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps an expression to a prensor, and merges that prensor.</p>
<p>For example, suppose you have an op my_op, that takes a prensor of the form:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>  event
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  /  \
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>foo  bar
</span></code></pre></div>
<p>and produces a prensor of the form my_result_schema:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>  event
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  /  \
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>foo2 bar2
</span></code></pre></div>
<p>If you give it an expression original with the schema:</p>
<p></p><div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a> session
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    |
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>  event
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  /  \
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>foo   bar
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">result</span> <span class="o">=</span> <span class="n">map_prensor_to_prensor</span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  <span class="n">original</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"session"</span><span class="p">,</span><span class="s2">"event"</span><span class="p">]),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>  <span class="n">my_op</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  <span class="n">my_output_schema</span><span class="p">)</span>
</span></code></pre></div>
<p>Result will have the schema:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a> session
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    |
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  event--------
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  /  \    \    \
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>foo   bar foo2 bar2
</span></code></pre></div>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root_expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the root expression</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path where the prensor op is applied.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>paths_needed</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the paths needed for the op.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prensor_op</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the prensor op</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[[<a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a>], <a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_schema</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the output schema of the op.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new expression where the prensor is merged.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_prensor_to_prensor.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_prensor_to_prensor</span><span class="p">(</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">root_expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">paths_needed</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">prensor_op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">prensor</span><span class="o">.</span><span class="n">Prensor</span><span class="p">],</span> <span class="n">prensor</span><span class="o">.</span><span class="n">Prensor</span><span class="p">],</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">output_schema</span><span class="p">:</span> <span class="n">Schema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="w">  </span><span class="sa">r</span><span class="sd">"""Maps an expression to a prensor, and merges that prensor.</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">  For example, suppose you have an op my_op, that takes a prensor of the form:</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">  ```</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    event</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    /  \</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">  foo  bar</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">  ```</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">  and produces a prensor of the form my_result_schema:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">  ```</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    event</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    /  \</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">  foo2 bar2</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">  ```</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">  If you give it an expression original with the schema:</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">  ```</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">   session</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">      |</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    event</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    /  \</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">  foo   bar</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">  ```</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">  ```python</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">  result = map_prensor_to_prensor(</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    original,</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    path.Path(["session","event"]),</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    my_op,</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    my_output_schema)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">  ```</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">  Result will have the schema:</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">  ```</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">   session</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">      |</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    event--------</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    /  \    \    \</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">  foo   bar foo2 bar2</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">  ```</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">  Args:</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    root_expr: the root expression</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    source: the path where the prensor op is applied.</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    paths_needed: the paths needed for the op.</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    prensor_op: the prensor op</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    output_schema: the output schema of the op.</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    A new expression where the prensor is merged.</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">  """</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>  <span class="n">original_child</span> <span class="o">=</span> <span class="n">root_expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>      <span class="n">paths_needed</span><span class="p">)</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>  <span class="n">prensor_child</span> <span class="o">=</span> <span class="n">_PrensorOpExpression</span><span class="p">(</span><span class="n">original_child</span><span class="p">,</span> <span class="n">prensor_op</span><span class="p">,</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>                                       <span class="n">output_schema</span><span class="p">)</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>  <span class="n">paths_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>      <span class="n">source</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">prensor_child</span><span class="o">.</span><span class="n">get_child_or_error</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">prensor_child</span><span class="o">.</span><span class="n">known_field_names</span><span class="p">()</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>  <span class="p">}</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span><span class="n">root_expr</span><span class="p">,</span> <span class="n">paths_map</span><span class="p">)</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.map_prensor_to_prensor-modules">Modules<a href="#struct2tensor.expression_impl.map_prensor_to_prensor-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.map_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">map_values</span>


<a href="#struct2tensor.expression_impl.map_values" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Maps the values of various leaves of the same child to a single result.</p>
<p>All inputs must have the same shape (parent_index must be equal).</p>
<p>The output is given the same shape (output of function must be of equal length).</p>
<p>Note that the operations are on 1-D tensors (as opposed to scalars).</p>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_many_values (struct2tensor.expression_impl.map_values.map_many_values)" href="#struct2tensor.expression_impl.map_values.map_many_values">map_many_values</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map multiple sibling fields into a new sibling.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_values (struct2tensor.expression_impl.map_values.map_values)" href="#struct2tensor.expression_impl.map_values.map_values">map_values</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map field into a new sibling.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_values_anonymous (struct2tensor.expression_impl.map_values.map_values_anonymous)" href="#struct2tensor.expression_impl.map_values.map_values_anonymous">map_values_anonymous</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map field into a new sibling.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.map_values-functions">Functions<a href="#struct2tensor.expression_impl.map_values-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_values.map_many_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">map_many_values</span>


<a href="#struct2tensor.expression_impl.map_values.map_many_values" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_many_values</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">operation</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map multiple sibling fields into a new sibling.</p>
<p>All source fields must have the same shape, and the shape of the output
must be the same as well.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>original root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>parent path of all sources and the new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>source fields of the operation. Must have the same shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>operation from source_fields to new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.Tensor">Tensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>type of new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>name of the new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>, <a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression and the new path as a pair.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_values.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_many_values</span><span class="p">(</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span> <span class="n">operation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">  </span><span class="sd">"""Map multiple sibling fields into a new sibling.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">  All source fields must have the same shape, and the shape of the output</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">  must be the same as well.</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">  Args:</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    root: original root.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    parent_path: parent path of all sources and the new field.</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    source_fields: source fields of the operation. Must have the same shape.</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    operation: operation from source_fields to new field.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    dtype: type of new field.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    new_field_name: name of the new field.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    The new expression and the new path as a pair.</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">  """</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>  <span class="n">new_path</span> <span class="o">=</span> <span class="n">parent_path</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>      <span class="n">root</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>          <span class="n">new_path</span><span class="p">:</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>              <span class="n">_MapValuesExpression</span><span class="p">([</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>                  <span class="n">root</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">parent_path</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>                  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>              <span class="p">],</span> <span class="n">operation</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>      <span class="p">}),</span> <span class="n">new_path</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_values.map_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">map_values</span>


<a href="#struct2tensor.expression_impl.map_values.map_values" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_values</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operation</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map field into a new sibling.</p>
<p>The shape of the output must be the same as the input.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>original root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>source of the operation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>operation from source_fields to new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[[<span title="tensorflow.Tensor">Tensor</span>], <span title="tensorflow.Tensor">Tensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>type of new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>name of the new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_values.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_values</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>               <span class="n">operation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>               <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">  </span><span class="sd">"""Map field into a new sibling.</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">  The shape of the output must be the same as the input.</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">  Args:</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    root: original root.</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    source_path: source of the operation.</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    operation: operation from source_fields to new field.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    dtype: type of new field.</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    new_field_name: name of the new field.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    The new expression.</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">  """</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path</span><span class="p">:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Cannot map the root.'</span><span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>  <span class="k">return</span> <span class="n">map_many_values</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">source_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">(),</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>                         <span class="p">[</span><span class="n">source_path</span><span class="o">.</span><span class="n">field_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">operation</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                         <span class="n">new_field_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.map_values.map_values_anonymous" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">map_values_anonymous</span>


<a href="#struct2tensor.expression_impl.map_values.map_values_anonymous" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_values_anonymous</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operation</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map field into a new sibling.</p>
<p>The shape of the output must be the same as the input.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>original root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>source of the operation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>operation from source_fields to new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[[<span title="tensorflow.Tensor">Tensor</span>], <span title="tensorflow.Tensor">Tensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>type of new field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>, <a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression and the new path as a pair.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/map_values.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_values_anonymous</span><span class="p">(</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">operation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">  </span><span class="sd">"""Map field into a new sibling.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">  The shape of the output must be the same as the input.</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">  Args:</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    root: original root.</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    source_path: source of the operation.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    operation: operation from source_fields to new field.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    dtype: type of new field.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    The new expression and the new path as a pair.</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">  """</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path</span><span class="p">:</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Cannot map the root.'</span><span class="p">)</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>  <span class="k">return</span> <span class="n">map_many_values</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">source_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">(),</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>                         <span class="p">[</span><span class="n">source_path</span><span class="o">.</span><span class="n">field_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">operation</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>                         <span class="n">path</span><span class="o">.</span><span class="n">get_anonymous_field</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.map_values-modules">Modules<a href="#struct2tensor.expression_impl.map_values-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.parquet" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">parquet</span>


<a href="#struct2tensor.expression_impl.parquet" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Apache Parquet Dataset.</p>
<div class="admonition example">
<p class="admonition-title">Example Usage</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">exp</span> <span class="o">=</span> <span class="n">create_expression_from_parquet_file</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">docid_project_exp</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"DocId"</span><span class="p">])])</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">pqds</span> <span class="o">=</span> <span class="n">parquet_dataset</span><span class="o">.</span><span class="n">calculate_parquet_values</span><span class="p">([</span><span class="n">docid_project_exp</span><span class="p">],</span> <span class="n">exp</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                                                <span class="n">filenames</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">for</span> <span class="n">prensors</span> <span class="ow">in</span> <span class="n">pqds</span><span class="p">:</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>  <span class="n">doc_id_prensor</span> <span class="o">=</span> <span class="n">prensors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div>
</div>








<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">CLASS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            ParquetDataset (struct2tensor.expression_impl.parquet.ParquetDataset)" href="#struct2tensor.expression_impl.parquet.ParquetDataset">ParquetDataset</a></code></td>
            <td class="doc-class-details">
              <div class="doc-md-description">
                <p>A dataset which reads columns from a parquet file and returns a prensor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculate_parquet_values (struct2tensor.expression_impl.parquet.calculate_parquet_values)" href="#struct2tensor.expression_impl.parquet.calculate_parquet_values">calculate_parquet_values</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculates expressions and returns a parquet dataset.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_expression_from_parquet_file (struct2tensor.expression_impl.parquet.create_expression_from_parquet_file)" href="#struct2tensor.expression_impl.parquet.create_expression_from_parquet_file">create_expression_from_parquet_file</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a placeholder expression from a parquet file.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">






<h5 id="struct2tensor.expression_impl.parquet-classes">Classes<a href="#struct2tensor.expression_impl.parquet-classes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-class">



<h6 id="struct2tensor.expression_impl.parquet.ParquetDataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ParquetDataset</span>


<a href="#struct2tensor.expression_impl.parquet.ParquetDataset" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">ParquetDataset</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">filenames</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">value_paths</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="struct2tensor.expression_impl.parquet._RawParquetDataset">_RawParquetDataset</span></code></p>


        <p>A dataset which reads columns from a parquet file and returns a prensor.</p>
<p>The prensor will have a PrensorTypeSpec, which is created based on
value_paths.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In tensorflow v1 this dataset will not return a prensor. The output will
be the same format as _RawParquetDataset's output (a vector of tensors).
The following is a workaround in v1:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">pq_ds</span> <span class="o">=</span> <span class="n">ParquetDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">type_spec</span> <span class="o">=</span> <span class="n">pq_ds</span><span class="o">.</span><span class="n">element_spec</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">tensors</span> <span class="o">=</span> <span class="n">pq_ds</span><span class="o">.</span><span class="n">make_one_shot_iterator</span><span class="p">()</span><span class="o">.</span><span class="n">get_next</span><span class="p">()</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">prensor</span> <span class="o">=</span> <span class="n">type_spec</span><span class="o">.</span><span class="n">from_components</span><span class="p">(</span><span class="n">tensors</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">prensor</span><span class="p">)</span>
</span></code></pre></div>
</div>

        <p>Creates a ParquetDataset.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filenames</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A list containing the name(s) of the file(s) to be read.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value_paths</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A list of strings of the dotstring path(s) of each leaf
path(s).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An int that determines how many messages are parsed into one
prensor tree in an iteration. If there are fewer than batch_size
remaining messages, then all remaining messages will be returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>if the column does not exist in the parquet schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>












<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            element_spec


  
      property
   (struct2tensor.expression_impl.parquet.ParquetDataset.element_spec)" href="#struct2tensor.expression_impl.parquet.ParquetDataset.element_spec">element_spec</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            element_structure


  
      instance-attribute
   (struct2tensor.expression_impl.parquet.ParquetDataset.element_structure)" href="#struct2tensor.expression_impl.parquet.ParquetDataset.element_structure">element_structure</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            output_classes


  
      property
   (struct2tensor.expression_impl.parquet.ParquetDataset.output_classes)" href="#struct2tensor.expression_impl.parquet.ParquetDataset.output_classes">output_classes</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            output_shapes


  
      property
   (struct2tensor.expression_impl.parquet.ParquetDataset.output_shapes)" href="#struct2tensor.expression_impl.parquet.ParquetDataset.output_shapes">output_shapes</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            output_types


  
      property
   (struct2tensor.expression_impl.parquet.ParquetDataset.output_types)" href="#struct2tensor.expression_impl.parquet.ParquetDataset.output_types">output_types</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

                  <details class="quote">
                    <summary>Source code in <code>struct2tensor/expression_impl/parquet.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">value_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>             <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="w">  </span><span class="sd">"""Creates a ParquetDataset.</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">  Args:</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    filenames: A list containing the name(s) of the file(s) to be read.</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    value_paths: A list of strings of the dotstring path(s) of each leaf</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">      path(s).</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    batch_size: An int that determines how many messages are parsed into one</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">      prensor tree in an iteration. If there are fewer than batch_size</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">      remaining messages, then all remaining messages will be returned.</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">  Raises:</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">    ValueError: if the column does not exist in the parquet schema.</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">  """</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span> <span class="o">=</span> <span class="n">filenames</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_value_paths</span> <span class="o">=</span> <span class="n">value_paths</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>  <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">value_paths</span><span class="p">)</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_value_dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_column_dtypes</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value_paths</span><span class="p">)</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_parent_index_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_path_index</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">element_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_prensor_spec</span><span class="p">()</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_create_parent_index_paths_and_index_from_type_spec</span><span class="p">(</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>      <span class="bp">self</span><span class="o">.</span><span class="n">element_structure</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>  <span class="nb">super</span><span class="p">(</span><span class="n">ParquetDataset</span><span class="p">,</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_dtypes</span><span class="p">,</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>                       <span class="bp">self</span><span class="o">.</span><span class="n">_parent_index_paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_index</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">





<h7 id="struct2tensor.expression_impl.parquet.ParquetDataset-attributes">Attributes<a href="#struct2tensor.expression_impl.parquet.ParquetDataset-attributes" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.parquet.ParquetDataset.element_spec" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">element_spec</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parquet.ParquetDataset.element_spec" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">element_spec</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.parquet.ParquetDataset.element_structure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">element_structure</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parquet.ParquetDataset.element_structure" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">element_structure</span> <span class="o">=</span> <span class="n"><span title="struct2tensor.expression_impl.parquet.ParquetDataset(self)._create_prensor_spec">_create_prensor_spec</span></span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.parquet.ParquetDataset.output_classes" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">output_classes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parquet.ParquetDataset.output_classes" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">output_classes</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.parquet.ParquetDataset.output_shapes" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">output_shapes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parquet.ParquetDataset.output_shapes" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">output_shapes</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.parquet.ParquetDataset.output_types" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">output_types</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parquet.ParquetDataset.output_types" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">output_types</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h7 id="struct2tensor.expression_impl.parquet.ParquetDataset-functions">Functions<a href="#struct2tensor.expression_impl.parquet.ParquetDataset-functions" class="headerlink" title="Permanent link">¶</a></h7>



  </div>

    </div>

</div>
<h5 id="struct2tensor.expression_impl.parquet-functions">Functions<a href="#struct2tensor.expression_impl.parquet-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.parquet.calculate_parquet_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">calculate_parquet_values</span>


<a href="#struct2tensor.expression_impl.parquet.calculate_parquet_values" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_parquet_values</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expressions</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">root_exp</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression_impl.placeholder._PlaceholderRootExpression">_PlaceholderRootExpression</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">filenames</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">options</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.calculate_options.Options">Options</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculates expressions and returns a parquet dataset.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expressions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A list of expressions to calculate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_exp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The root placeholder expression to use as the feed dict.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression_impl.placeholder._PlaceholderRootExpression">_PlaceholderRootExpression</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filenames</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A list of parquet files.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The number of messages to batch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>calculate options.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.calculate_options.Options">Options</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A parquet dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/parquet.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_parquet_values</span><span class="p">(</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">expressions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">],</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">root_exp</span><span class="p">:</span> <span class="n">placeholder</span><span class="o">.</span><span class="n">_PlaceholderRootExpression</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">calculate_options</span><span class="o">.</span><span class="n">Options</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">  </span><span class="sd">"""Calculates expressions and returns a parquet dataset.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">  Args:</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    expressions: A list of expressions to calculate.</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    root_exp: The root placeholder expression to use as the feed dict.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    filenames: A list of parquet files.</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    batch_size: The number of messages to batch.</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    options: calculate options.</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    A parquet dataset.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">  """</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>  <span class="n">pqds</span> <span class="o">=</span> <span class="n">_ParquetDatasetWithExpression</span><span class="p">(</span><span class="n">expressions</span><span class="p">,</span> <span class="n">root_exp</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>                                       <span class="n">batch_size</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>  <span class="k">return</span> <span class="n">pqds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pqds</span><span class="o">.</span><span class="n">_calculate_prensor</span><span class="p">)</span>  <span class="c1"># pylint: disable=protected-access</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.parquet.create_expression_from_parquet_file" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_expression_from_parquet_file</span>


<a href="#struct2tensor.expression_impl.parquet.create_expression_from_parquet_file" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_expression_from_parquet_file</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">filenames</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="struct2tensor.expression_impl.placeholder._PlaceholderRootExpression">_PlaceholderRootExpression</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a placeholder expression from a parquet file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filenames</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>A list of parquet files.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="struct2tensor.expression_impl.placeholder._PlaceholderRootExpression">_PlaceholderRootExpression</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A PlaceholderRootExpression that should be used as the root of an expression
graph.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/parquet.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_expression_from_parquet_file</span><span class="p">(</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">placeholder</span><span class="o">.</span><span class="n">_PlaceholderRootExpression</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">  </span><span class="sd">"""Creates a placeholder expression from a parquet file.</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">  Args:</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    filenames: A list of parquet files.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    A PlaceholderRootExpression that should be used as the root of an expression</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">      graph.</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">  """</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>  <span class="n">metadata</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">metadata</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>  <span class="n">parquet_schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>  <span class="n">arrow_schema</span> <span class="o">=</span> <span class="n">parquet_schema</span><span class="o">.</span><span class="n">to_arrow_schema</span><span class="p">()</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>  <span class="n">root_schema</span> <span class="o">=</span> <span class="n">mpp</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>      <span class="n">is_repeated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>      <span class="n">children</span><span class="o">=</span><span class="n">_create_children_from_arrow_fields</span><span class="p">(</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>          <span class="p">[</span><span class="n">arrow_schema</span><span class="o">.</span><span class="n">field_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">arrow_schema</span><span class="o">.</span><span class="n">names</span><span class="p">]))</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>  <span class="c1"># pylint: disable=protected-access</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>  <span class="k">return</span> <span class="n">placeholder</span><span class="o">.</span><span class="n">_PlaceholderRootExpression</span><span class="p">(</span><span class="n">root_schema</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.parquet-modules">Modules<a href="#struct2tensor.expression_impl.parquet-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.parse_message_level_ex" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">parse_message_level_ex</span>


<a href="#struct2tensor.expression_impl.parse_message_level_ex" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Parses regular fields, extensions, any casts, and map protos.</p>
<p>This is intended for use within proto.py, not independently.</p>
<p>parse_message_level(...) in struct2tensor_ops provides a direct interface to
parsing a protocol buffer message. In particular, extensions and regular fields
can be directly extracted from the protobuf. However, prensors provide other
syntactic sugar to parse protobufs, and parse_message_level_ex(...) handles
these in addition to regular fields and extensions.</p>
<p>Specifically, consider google.protobuf.Any and proto maps:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">package</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">message</span> <span class="n">MyMessage</span> <span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  <span class="n">Any</span> <span class="n">my_any</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  <span class="nb">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">Baz</span><span class="o">&gt;</span> <span class="n">my_map</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">message</span> <span class="n">Baz</span> <span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>  <span class="n">int32</span> <span class="n">my_int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>  <span class="o">...</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then for MyMessage, the path my_any.(foo.bar.Baz).my_int is an optional path.
Also, my_map[x].my_int is an optional path.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>  MyMessage--------------
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>     \  my_any?          \ my_map[x]
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>      *                   *
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>       \  (foo.bar.Baz)?   \  my_int?
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        *                   *
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>         \  my_int?
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>          *
</span></code></pre></div>
<p>Thus, we can run:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">my_message_serialized_tensor</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">my_message_parsed</span> <span class="o">=</span> <span class="n">parse_message_level_ex</span><span class="p">(</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">my_message_serialized_tensor</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">MyMessage</span><span class="o">.</span><span class="n">DESCRIPTOR</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="p">{</span><span class="s2">"my_any"</span><span class="p">,</span> <span class="s2">"my_map[x]"</span><span class="p">})</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">my_any_serialized</span> <span class="o">=</span> <span class="n">my_message_parsed</span><span class="p">[</span><span class="s2">"my_any"</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="n">my_any_parsed</span> <span class="o">=</span> <span class="n">parse_message_level_ex</span><span class="p">(</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">my_any_serialized</span><span class="p">,</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">Any</span><span class="o">.</span><span class="n">DESCRIPTOR</span><span class="p">,</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="p">{</span><span class="s2">"(foo.bar.Baz)"</span><span class="p">})</span>
</span></code></pre></div>
<p>At this point, my_message_parsed["my_map[x]"].value AND
my_any_parsed["(foo.bar.Baz)"].value are serialized Baz tensors.</p>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_full_name_from_any_step (struct2tensor.expression_impl.parse_message_level_ex.get_full_name_from_any_step)" href="#struct2tensor.expression_impl.parse_message_level_ex.get_full_name_from_any_step">get_full_name_from_any_step</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets the full name of a protobuf from a google.protobuf.Any step.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            is_any_descriptor (struct2tensor.expression_impl.parse_message_level_ex.is_any_descriptor)" href="#struct2tensor.expression_impl.parse_message_level_ex.is_any_descriptor">is_any_descriptor</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns true if it is an Any descriptor.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            parse_message_level_ex (struct2tensor.expression_impl.parse_message_level_ex.parse_message_level_ex)" href="#struct2tensor.expression_impl.parse_message_level_ex.parse_message_level_ex">parse_message_level_ex</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Parses regular fields, extensions, any casts, and map protos.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName">ProtoFieldName</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            ProtoFullName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFullName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFullName">ProtoFullName</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            StrStep


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.StrStep)" href="#struct2tensor.expression_impl.parse_message_level_ex.StrStep">StrStep</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>



  <div class="doc doc-children">





<h5 id="struct2tensor.expression_impl.parse_message_level_ex-attributes">Attributes<a href="#struct2tensor.expression_impl.parse_message_level_ex-attributes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">ProtoFieldName</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ProtoFieldName</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.parse_message_level_ex.ProtoFullName" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">ProtoFullName</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFullName" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ProtoFullName</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.parse_message_level_ex.StrStep" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">StrStep</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.parse_message_level_ex.StrStep" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">StrStep</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h5 id="struct2tensor.expression_impl.parse_message_level_ex-functions">Functions<a href="#struct2tensor.expression_impl.parse_message_level_ex-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.parse_message_level_ex.get_full_name_from_any_step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_full_name_from_any_step</span>


<a href="#struct2tensor.expression_impl.parse_message_level_ex.get_full_name_from_any_step" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_full_name_from_any_step</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">step</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName">ProtoFieldName</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName">ProtoFieldName</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the full name of a protobuf from a google.protobuf.Any step.</p>
<p>An any step is of the form (foo.com/bar.Baz). In this case the result would
be bar.Baz.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the string of a step in a path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName">ProtoFieldName</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName">ProtoFieldName</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the full name of a protobuf if the step is an any step, or None otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/parse_message_level_ex.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_full_name_from_any_step</span><span class="p">(</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">step</span><span class="p">:</span> <span class="n">ProtoFieldName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProtoFieldName</span><span class="p">]:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">  </span><span class="sd">"""Gets the full name of a protobuf from a google.protobuf.Any step.</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">  An any step is of the form (foo.com/bar.Baz). In this case the result would</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">  be bar.Baz.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">  Args:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    step: the string of a step in a path.</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    the full name of a protobuf if the step is an any step, or None otherwise.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">  """</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span><span class="p">:</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>  <span class="k">if</span> <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"("</span><span class="p">:</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>  <span class="k">if</span> <span class="n">step</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">")"</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>  <span class="n">step_without_parens</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>  <span class="k">return</span> <span class="n">step_without_parens</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.parse_message_level_ex.is_any_descriptor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">is_any_descriptor</span>


<a href="#struct2tensor.expression_impl.parse_message_level_ex.is_any_descriptor" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">is_any_descriptor</span><span class="p">(</span><span class="n">desc</span><span class="p">:</span> <span class="n"><span title="google.protobuf.descriptor.Descriptor">Descriptor</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns true if it is an Any descriptor.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/parse_message_level_ex.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_any_descriptor</span><span class="p">(</span><span class="n">desc</span><span class="p">:</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">  </span><span class="sd">"""Returns true if it is an Any descriptor."""</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>  <span class="k">return</span> <span class="n">desc</span><span class="o">.</span><span class="n">full_name</span> <span class="o">==</span> <span class="s2">"google.protobuf.Any"</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.parse_message_level_ex.parse_message_level_ex" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">parse_message_level_ex</span>


<a href="#struct2tensor.expression_impl.parse_message_level_ex.parse_message_level_ex" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">parse_message_level_ex</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">tensor_of_protos</span><span class="p">:</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">desc</span><span class="p">:</span> <span class="n"><span title="google.protobuf.descriptor.Descriptor">Descriptor</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">field_names</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Set" href="https://docs.python.org/3/library/typing.html#typing.Set">Set</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName)" href="#struct2tensor.expression_impl.parse_message_level_ex.ProtoFieldName">ProtoFieldName</a></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">message_format</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">backing_str_tensor</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">honor_proto3_optional_semantics</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            StrStep


  
      module-attribute
   (struct2tensor.expression_impl.parse_message_level_ex.StrStep)" href="#struct2tensor.expression_impl.parse_message_level_ex.StrStep">StrStep</a></span><span class="p">,</span> <span class="n"><span title="struct2tensor.ops.struct2tensor_ops._ParsedField">_ParsedField</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Parses regular fields, extensions, any casts, and map protos.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/parse_message_level_ex.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">def</span><span class="w"> </span><span class="nf">parse_message_level_ex</span><span class="p">(</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">tensor_of_protos</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">desc</span><span class="p">:</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">,</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">field_names</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">ProtoFieldName</span><span class="p">],</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">message_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">,</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">backing_str_tensor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">honor_proto3_optional_semantics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">StrStep</span><span class="p">,</span> <span class="n">struct2tensor_ops</span><span class="o">.</span><span class="n">_ParsedField</span><span class="p">]:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">  </span><span class="sd">"""Parses regular fields, extensions, any casts, and map protos."""</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>  <span class="n">raw_field_names</span> <span class="o">=</span> <span class="n">_get_field_names_to_parse</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">field_names</span><span class="p">)</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>  <span class="n">regular_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>      <span class="n">struct2tensor_ops</span><span class="o">.</span><span class="n">parse_message_level</span><span class="p">(</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>          <span class="n">tensor_of_protos</span><span class="p">,</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>          <span class="n">desc</span><span class="p">,</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>          <span class="n">raw_field_names</span><span class="p">,</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>          <span class="n">message_format</span><span class="o">=</span><span class="n">message_format</span><span class="p">,</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>          <span class="n">backing_str_tensor</span><span class="o">=</span><span class="n">backing_str_tensor</span><span class="p">,</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>          <span class="n">honor_proto3_optional_semantics</span><span class="o">=</span><span class="n">honor_proto3_optional_semantics</span><span class="p">))</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>  <span class="n">regular_field_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">field_name</span><span class="p">:</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">regular_fields</span><span class="p">}</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>  <span class="n">any_fields</span> <span class="o">=</span> <span class="n">_get_any_parsed_fields</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">regular_field_map</span><span class="p">,</span> <span class="n">field_names</span><span class="p">)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>  <span class="n">map_fields</span> <span class="o">=</span> <span class="n">_get_map_parsed_fields</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">regular_field_map</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>                                      <span class="n">backing_str_tensor</span><span class="p">)</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">regular_field_map</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>  <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">any_fields</span><span class="p">)</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>  <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">map_fields</span><span class="p">)</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.parse_message_level_ex-modules">Modules<a href="#struct2tensor.expression_impl.parse_message_level_ex-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.placeholder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">placeholder</span>


<a href="#struct2tensor.expression_impl.placeholder" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Placeholder expression.</p>
<p>A placeholder expression represents prensor nodes, however a prensor is not
needed until calculate is called. This allows the user to apply expression
queries to a placeholder expression before having an actual prensor object.
When calculate is called on a placeholder expression (or a descendant of a
placeholder expression), the feed_dict will need to be passed in. Then calculate
will bind the prensor with the appropriate placeholder expression.</p>
<p>Sample usage:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">placeholder_exp</span> <span class="o">=</span> <span class="n">placeholder</span><span class="o">.</span><span class="n">create_expression_from_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">new_exp</span> <span class="o">=</span> <span class="n">expression_queries</span><span class="p">(</span><span class="n">placeholder_exp</span><span class="p">,</span> <span class="o">..</span><span class="p">)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">result</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">calculate_values</span><span class="p">([</span><span class="n">new_exp</span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                                    <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">placeholder_exp</span><span class="p">:</span> <span class="n">pren</span><span class="p">})</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># placeholder_exp requires a feed_dict to be passed in when calculating</span>
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_expression_from_schema (struct2tensor.expression_impl.placeholder.create_expression_from_schema)" href="#struct2tensor.expression_impl.placeholder.create_expression_from_schema">create_expression_from_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a placeholder expression from a parquet schema.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_placeholder_paths_from_graph (struct2tensor.expression_impl.placeholder.get_placeholder_paths_from_graph)" href="#struct2tensor.expression_impl.placeholder.get_placeholder_paths_from_graph">get_placeholder_paths_from_graph</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets all placeholder paths from an expression graph.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.placeholder-functions">Functions<a href="#struct2tensor.expression_impl.placeholder-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.placeholder.create_expression_from_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_expression_from_schema</span>


<a href="#struct2tensor.expression_impl.placeholder.create_expression_from_schema" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_expression_from_schema</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">schema</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="struct2tensor.expression_impl.placeholder._PlaceholderRootExpression">_PlaceholderRootExpression</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a placeholder expression from a parquet schema.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The schema that describes the prensor tree that this placeholder
represents.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Schema (struct2tensor.expression_impl.map_prensor_to_prensor.Schema)" href="#struct2tensor.expression_impl.map_prensor_to_prensor.Schema">Schema</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="struct2tensor.expression_impl.placeholder._PlaceholderRootExpression">_PlaceholderRootExpression</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A PlaceholderRootExpression that should be used as the root of an expression
graph.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/placeholder.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_expression_from_schema</span><span class="p">(</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">schema</span><span class="p">:</span> <span class="n">mpp</span><span class="o">.</span><span class="n">Schema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"_PlaceholderRootExpression"</span><span class="p">:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">  </span><span class="sd">"""Creates a placeholder expression from a parquet schema.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">  Args:</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    schema: The schema that describes the prensor tree that this placeholder</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">      represents.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    A PlaceholderRootExpression that should be used as the root of an expression</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">      graph.</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">  """</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>  <span class="k">return</span> <span class="n">_PlaceholderRootExpression</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.placeholder.get_placeholder_paths_from_graph" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">get_placeholder_paths_from_graph</span>


<a href="#struct2tensor.expression_impl.placeholder.get_placeholder_paths_from_graph" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_placeholder_paths_from_graph</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">graph</span><span class="p">:</span> <span class="n"><span title="struct2tensor.calculate.ExpressionGraph">ExpressionGraph</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets all placeholder paths from an expression graph.</p>
<p>This finds all leaf placeholder expressions in an expression graph, and gets
the path of these expressions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>expression graph</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.calculate.ExpressionGraph">ExpressionGraph</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a list of paths of placeholder expressions</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/placeholder.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_placeholder_paths_from_graph</span><span class="p">(</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">graph</span><span class="p">:</span> <span class="n">calculate</span><span class="o">.</span><span class="n">ExpressionGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">  </span><span class="sd">"""Gets all placeholder paths from an expression graph.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">  This finds all leaf placeholder expressions in an expression graph, and gets</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">  the path of these expressions.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">  Args:</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    graph: expression graph</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    a list of paths of placeholder expressions</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">  """</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>  <span class="n">expressions</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>      <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_expressions_needed</span><span class="p">()</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">_is_placeholder_expression</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">)</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>  <span class="p">]</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>  <span class="n">expressions</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">_PlaceholderExpression</span><span class="p">],</span> <span class="n">expressions</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>  <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.placeholder-modules">Modules<a href="#struct2tensor.expression_impl.placeholder-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.project" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">project</span>


<a href="#struct2tensor.expression_impl.project" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>project selects a subtree of an expression.</p>
<p>project is often used right before calculating the value.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">expr</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">new_expr</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span><span class="s2">"bar"</span><span class="p">]),</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>                                  <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])])</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">[</span><span class="n">prensor_result</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate</span><span class="o">.</span><span class="n">calculate_prensors</span><span class="p">([</span><span class="n">new_expr</span><span class="p">])</span>
</span></code></pre></div>
<p>prensor_result now has two paths, "foo.bar" and "x.y".</p>
</div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            project (struct2tensor.expression_impl.project.project)" href="#struct2tensor.expression_impl.project.project">project</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>select a subtree.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.project-functions">Functions<a href="#struct2tensor.expression_impl.project-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.project.project" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">project</span>


<a href="#struct2tensor.expression_impl.project.project" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">project</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">paths</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>select a subtree.</p>
<p>Paths not selected are removed.
Paths that are selected are "known", such that if calculate_prensors is
called, they will be in the result.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>paths</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the paths to include.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A projected expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/project.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="n">paths</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">  </span><span class="sd">"""select a subtree.</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">  Paths not selected are removed.</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">  Paths that are selected are "known", such that if calculate_prensors is</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">  called, they will be in the result.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">  Args:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    expr: the original expression.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    paths: the paths to include.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    A projected expression.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">  """</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>  <span class="n">missing_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>  <span class="k">if</span> <span class="n">missing_paths</span><span class="p">:</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2"> Path(s) missing in project: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="nb">len</span><span class="p">(</span><span class="n">missing_paths</span><span class="p">),</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing_paths</span><span class="p">])))</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>  <span class="k">return</span> <span class="n">_ProjectExpression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.project-modules">Modules<a href="#struct2tensor.expression_impl.project-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.promote" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">promote</span>


<a href="#struct2tensor.expression_impl.promote" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Promote an expression to be a child of its grandparent.</p>
<p>Promote is part of the standard flattening of data, promote_and_broadcast,
which takes structured data and flattens it. By directly accessing promote,
one can perform simpler operations.</p>
<p>For example, suppose an expr represents:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>+
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>|
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>+-session*   (stars indicate repeated)
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>     |
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>     +-event*
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>         |
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>         +-val*-int64
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">121</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">122</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="p">}</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">promote</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"session"</span><span class="p">,</span> <span class="s2">"event"</span><span class="p">,</span> <span class="s2">"val"</span><span class="p">]),</span> <span class="n">nval</span><span class="p">)</span>
</span></code></pre></div>
<p>produces:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>+
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>|
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>+-session*   (stars indicate repeated)
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>     |
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>     +-event*
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>     |    |
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>     |    +-val*-int64
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>     |
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>     +-nval*-int64
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">session</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  <span class="n">event</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">val</span><span class="p">:</span> <span class="mi">111</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  <span class="p">}</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>  <span class="n">event</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">val</span><span class="p">:</span> <span class="mi">121</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="n">val</span><span class="p">:</span> <span class="mi">122</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>  <span class="p">}</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>  <span class="n">nval</span><span class="p">:</span> <span class="mi">111</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>  <span class="n">nval</span><span class="p">:</span> <span class="mi">121</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>  <span class="n">nval</span><span class="p">:</span> <span class="mi">122</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">}</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="n">session</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>  <span class="n">event</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="n">val</span><span class="p">:</span> <span class="mi">10</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="n">val</span><span class="p">:</span> <span class="mi">7</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>  <span class="p">}</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>  <span class="n">event</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="n">val</span><span class="p">:</span> <span class="mi">1</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>  <span class="p">}</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>  <span class="n">nval</span><span class="p">:</span> <span class="mi">10</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>  <span class="n">nval</span><span class="p">:</span> <span class="mi">7</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>  <span class="n">nval</span><span class="p">:</span> <span class="mi">1</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="p">}</span>
</span></code></pre></div>








<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">CLASS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            PromoteChildExpression (struct2tensor.expression_impl.promote.PromoteChildExpression)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression">PromoteChildExpression</a></code></td>
            <td class="doc-class-details">
              <div class="doc-md-description">
                <p>The root of the promoted sub tree.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            PromoteExpression (struct2tensor.expression_impl.promote.PromoteExpression)" href="#struct2tensor.expression_impl.promote.PromoteExpression">PromoteExpression</a></code></td>
            <td class="doc-class-details">
              <div class="doc-md-description">
                <p>A promoted leaf.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote (struct2tensor.expression_impl.promote.promote)" href="#struct2tensor.expression_impl.promote.promote">promote</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promote a path to be a child of its grandparent, and give it a name.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote_anonymous (struct2tensor.expression_impl.promote.promote_anonymous)" href="#struct2tensor.expression_impl.promote.promote_anonymous">promote_anonymous</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promote a path to be a new anonymous child of its grandparent.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">






<h5 id="struct2tensor.expression_impl.promote-classes">Classes<a href="#struct2tensor.expression_impl.promote-classes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-class">



<h6 id="struct2tensor.expression_impl.promote.PromoteChildExpression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PromoteChildExpression</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">PromoteChildExpression</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">origin_parent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code></p>


        <p>The root of the promoted sub tree.</p>

        <p>Initialize an expression.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if the expression is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>my_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the DType of a field, or None for an internal node.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_feature</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the local schema (StructDomain information should not be
present).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate_step_format</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, validates that steps do not have any
characters that could be ambiguously understood as structure delimiters
(e.g. "."). If False, such characters are allowed and the client is
responsible to ensure to not rely on any auto-coercion of strings to
paths.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply (struct2tensor.expression_impl.promote.PromoteChildExpression.apply)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.apply">apply</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply_schema (struct2tensor.expression_impl.promote.PromoteChildExpression.apply_schema)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.apply_schema">apply_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            broadcast (struct2tensor.expression_impl.promote.PromoteChildExpression.broadcast)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.broadcast">broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Broadcasts the existing field at source_path to the sibling_field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculate (struct2tensor.expression_impl.promote.PromoteChildExpression.calculate)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.calculate">calculate</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculates the node tensor of the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculation_equal (struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_equal)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_equal">calculation_equal</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>self.calculate is equal to another expression.calculate.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculation_is_identity (struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_is_identity)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_is_identity">calculation_is_identity</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>True iff the self.calculate is the identity.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            cogroup_by_index (struct2tensor.expression_impl.promote.PromoteChildExpression.cogroup_by_index)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.cogroup_by_index">cogroup_by_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a cogroup of left_name and right_name at new_field_name.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_has_field (struct2tensor.expression_impl.promote.PromoteChildExpression.create_has_field)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.create_has_field">create_has_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a field that is the presence of the source path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_proto_index (struct2tensor.expression_impl.promote.PromoteChildExpression.create_proto_index)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.create_proto_index">create_proto_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a proto index field as a direct child of the current root.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_size_field (struct2tensor.expression_impl.promote.PromoteChildExpression.create_size_field)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.create_size_field">create_size_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a field that is the size of the source path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child (struct2tensor.expression_impl.promote.PromoteChildExpression.get_child)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_child">get_child</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a named child.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child_or_error (struct2tensor.expression_impl.promote.PromoteChildExpression.get_child_or_error)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_child_or_error">get_child_or_error</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a named child.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_descendant (struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant">get_descendant</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Finds the descendant at the path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_descendant_or_error (struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant_or_error)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant_or_error">get_descendant_or_error</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Finds the descendant at the path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_known_children (struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_children)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_children">get_known_children</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_known_descendants (struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_descendants)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_descendants">get_known_descendants</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a mapping from known paths to subexpressions.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_paths_with_schema (struct2tensor.expression_impl.promote.PromoteChildExpression.get_paths_with_schema)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_paths_with_schema">get_paths_with_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Extract only paths that contain schema information.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_schema (struct2tensor.expression_impl.promote.PromoteChildExpression.get_schema)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_schema">get_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a schema for the entire tree.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_source_expressions (struct2tensor.expression_impl.promote.PromoteChildExpression.get_source_expressions)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_source_expressions">get_source_expressions</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets the sources of this expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            known_field_names (struct2tensor.expression_impl.promote.PromoteChildExpression.known_field_names)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.known_field_names">known_field_names</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns known field names of the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_field_values (struct2tensor.expression_impl.promote.PromoteChildExpression.map_field_values)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.map_field_values">map_field_values</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map a primitive field to create a new primitive field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_ragged_tensors (struct2tensor.expression_impl.promote.PromoteChildExpression.map_ragged_tensors)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.map_ragged_tensors">map_ragged_tensors</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a set of primitive fields of a message to a new field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_sparse_tensors (struct2tensor.expression_impl.promote.PromoteChildExpression.map_sparse_tensors)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.map_sparse_tensors">map_sparse_tensors</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a set of primitive fields of a message to a new field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            project (struct2tensor.expression_impl.promote.PromoteChildExpression.project)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.project">project</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Constrains the paths to those listed.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote (struct2tensor.expression_impl.promote.PromoteChildExpression.promote)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.promote">promote</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promotes source_path to be a field new_field_name in its grandparent.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote_and_broadcast (struct2tensor.expression_impl.promote.PromoteChildExpression.promote_and_broadcast)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.promote_and_broadcast">promote_and_broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            reroot (struct2tensor.expression_impl.promote.PromoteChildExpression.reroot)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.reroot">reroot</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a new list of protocol buffers available at new_root.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            schema_string (struct2tensor.expression_impl.promote.PromoteChildExpression.schema_string)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.schema_string">schema_string</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a schema for the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            slice (struct2tensor.expression_impl.promote.PromoteChildExpression.slice)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.slice">slice</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a slice copy of source_path at new_field_path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            truncate (struct2tensor.expression_impl.promote.PromoteChildExpression.truncate)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.truncate">truncate</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a truncated copy of source_path at new_field_path.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_leaf


  
      property
   (struct2tensor.expression_impl.promote.PromoteChildExpression.is_leaf)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.is_leaf">is_leaf</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>True iff the node tensor is a LeafNodeTensor.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_repeated


  
      property
   (struct2tensor.expression_impl.promote.PromoteChildExpression.is_repeated)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.is_repeated">is_repeated</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>True iff the same parent value can have multiple children values.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            schema_feature


  
      property
   (struct2tensor.expression_impl.promote.PromoteChildExpression.schema_feature)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.schema_feature">schema_feature</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Return the schema of the field.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            type


  
      property
   (struct2tensor.expression_impl.promote.PromoteChildExpression.type)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.type">type</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>dtype of the expression, or None if not a leaf expression.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            validate_step_format


  
      property
   (struct2tensor.expression_impl.promote.PromoteChildExpression.validate_step_format)" href="#struct2tensor.expression_impl.promote.PromoteChildExpression.validate_step_format">validate_step_format</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

                  <details class="quote">
                    <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>             <span class="n">origin_parent</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>  <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>      <span class="n">origin</span><span class="o">.</span><span class="n">is_repeated</span> <span class="ow">or</span> <span class="n">origin_parent</span><span class="o">.</span><span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>      <span class="n">origin</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>      <span class="n">schema_feature</span><span class="o">=</span><span class="n">_get_promote_schema_feature</span><span class="p">(</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>          <span class="n">origin</span><span class="o">.</span><span class="n">schema_feature</span><span class="p">,</span> <span class="n">origin_parent</span><span class="o">.</span><span class="n">schema_feature</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>      <span class="p">),</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>      <span class="n">validate_step_format</span><span class="o">=</span><span class="n">origin</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">,</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>  <span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">origin</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span> <span class="o">=</span> <span class="n">origin_parent</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_parent cannot be a field"</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">





<h7 id="struct2tensor.expression_impl.promote.PromoteChildExpression-attributes">Attributes<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression-attributes" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.is_leaf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_leaf</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.is_leaf" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_leaf</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the node tensor is a LeafNodeTensor.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.is_repeated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_repeated</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.is_repeated" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the same parent value can have multiple children values.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.schema_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">schema_feature</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.schema_feature" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">schema_feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the schema of the field.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.type" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">type</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.type" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>dtype of the expression, or None if not a leaf expression.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.validate_step_format" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">validate_step_format</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.validate_step_format" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">validate_step_format</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h7 id="struct2tensor.expression_impl.promote.PromoteChildExpression-functions">Functions<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression-functions" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.apply" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">apply</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.apply" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">transform</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>          <span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="s2">"Expression"</span><span class="p">],</span> <span class="s2">"Expression"</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>  <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.apply_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">apply_schema</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.apply_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>  <span class="k">return</span> <span class="n">apply_schema</span><span class="o">.</span><span class="n">apply_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">broadcast</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.broadcast" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">sibling_field</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Broadcasts the existing field at source_path to the sibling_field.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="k">def</span><span class="w"> </span><span class="nf">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">sibling_field</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>              <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="w">  </span><span class="sd">"""Broadcasts the existing field at source_path to the sibling_field."""</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>  <span class="k">return</span> <span class="n">broadcast</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>                             <span class="n">sibling_field</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.calculate" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">sources</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">destinations</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">options</span><span class="p">:</span> <span class="n"><span title="struct2tensor.calculate_options.Options">Options</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">side_info</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculates the node tensor of the expression.</p>
<p>The node tensor must be a function of the properties of the expression
and the node tensors of the expressions from get_source_expressions().</p>
<p>If is_leaf, then calculate must return a LeafNodeTensor.
Otherwise, it must return a ChildNodeTensor or RootNodeTensor.</p>
<p>If calculate_is_identity is true, then this must return source_tensors[0].</p>
<p>Sometimes, for operations such as parsing the proto, calculate will return
additional information. For example, calculate() for the root of the
proto expression also parses out the tensors required to calculate the
tensors of the children. This is why destinations are required.</p>
<p>For a reference use, see calculate_value_slowly(...) below.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_tensors</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The node tensors of the expressions in
get_source_expressions().</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destinations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expressions that will use the output of this method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Options for the calculation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.calculate_options.Options">Options</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>side_info</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An optional prensor that is used to bind to a placeholder
expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A NodeTensor representing the output of this expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">sources</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">prensor</span><span class="o">.</span><span class="n">NodeTensor</span><span class="p">],</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">destinations</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">],</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">options</span><span class="p">:</span> <span class="n">calculate_options</span><span class="o">.</span><span class="n">Options</span><span class="p">,</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">side_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prensor</span><span class="o">.</span><span class="n">Prensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">prensor</span><span class="o">.</span><span class="n">NodeTensor</span><span class="p">:</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>  <span class="p">[</span><span class="n">origin_value</span><span class="p">,</span> <span class="n">origin_parent_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin_value</span><span class="p">,</span> <span class="n">prensor</span><span class="o">.</span><span class="n">ChildNodeTensor</span><span class="p">):</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_value must be a child"</span><span class="p">)</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin_parent_value</span><span class="p">,</span> <span class="n">prensor</span><span class="o">.</span><span class="n">ChildNodeTensor</span><span class="p">):</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_parent_value must be a child node"</span><span class="p">)</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>  <span class="n">new_parent_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">origin_parent_value</span><span class="o">.</span><span class="n">parent_index</span><span class="p">,</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>                               <span class="n">origin_value</span><span class="o">.</span><span class="n">parent_index</span><span class="p">)</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>  <span class="k">return</span> <span class="n">prensor</span><span class="o">.</span><span class="n">ChildNodeTensor</span><span class="p">(</span><span class="n">new_parent_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_repeated</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_equal" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculation_equal</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_equal" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculation_equal</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>self.calculate is equal to another expression.calculate.</p>
<p>Given the same source node tensors, self.calculate(...) and
expression.calculate(...) will have the same result.</p>
<p>Note that this does not check that the source expressions of the two
expressions are the same. Therefore, two operations can have the same
calculation, but not the same output, because their sources are different.
For example, if a.calculation_is_identity() is True and
b.calculation_is_identity() is True, then a.calculation_equal(b) is True.
However, unless a and b have the same source, the expressions themselves are
not equal.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expression</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expression to compare to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculation_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">PromoteChildExpression</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_is_identity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculation_is_identity</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.calculation_is_identity" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculation_is_identity</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the self.calculate is the identity.</p>
<p>There is exactly one source, and the output of self.calculate(...) is the
node tensor of this source.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculation_is_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>  <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.cogroup_by_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">cogroup_by_index</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.cogroup_by_index" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">cogroup_by_index</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">left_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">right_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a cogroup of left_name and right_name at new_field_name.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="k">def</span><span class="w"> </span><span class="nf">cogroup_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">left_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>                     <span class="n">right_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="w">  </span><span class="sd">"""Creates a cogroup of left_name and right_name at new_field_name."""</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"cogroup_by_index is not implemented"</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.create_has_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_has_field</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.create_has_field" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_has_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a field that is the presence of the source path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_has_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="w">  </span><span class="sd">"""Creates a field that is the presence of the source path."""</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>  <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.create_proto_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_proto_index</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.create_proto_index" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_proto_index</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a proto index field as a direct child of the current root.</p>
<p>The proto index maps each root element to the original batch index.
For example: [0, 2] means the first element came from the first proto
in the original input tensor and the second element came from the third
proto. The created field is always "dense" -- it has the same valency as
the current root.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the field to be created.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An Expression object representing the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_proto_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="w">  </span><span class="sd">"""Creates a proto index field as a direct child of the current root.</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">  The proto index maps each root element to the original batch index.</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">  For example: [0, 2] means the first element came from the first proto</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">  in the original input tensor and the second element came from the third</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">  proto. The created field is always "dense" -- it has the same valency as</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">  the current root.</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">  Args:</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    field_name: the name of the field to be created.</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    An Expression object representing the result of the operation.</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">  """</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>  <span class="k">return</span> <span class="n">reroot</span><span class="o">.</span><span class="n">create_proto_index_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.create_size_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_size_field</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.create_size_field" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_size_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a field that is the size of the source path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_size_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>                      <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="w">  </span><span class="sd">"""Creates a field that is the size of the source path."""</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>  <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_child" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_child" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a named child.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="w">  </span><span class="sd">"""Gets a named child."""</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>  <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">:</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_child_impl</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_child_or_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child_or_error</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_child_or_error" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child_or_error</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a named child.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child_or_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="w">  </span><span class="sd">"""Gets a named child."""</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"No such field: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_name</span><span class="p">))</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_descendant</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the descendant at the path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="w">  </span><span class="sd">"""Finds the descendant at the path."""</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>  <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">field_list</span><span class="p">:</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>      <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant_or_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_descendant_or_error</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_descendant_or_error" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_descendant_or_error</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the descendant at the path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descendant_or_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">  </span><span class="sd">"""Finds the descendant at the path."""</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Missing path: </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_string</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)))</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_children" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_known_children</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_children" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_known_children</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_known_children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>  <span class="n">known_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_field_names</span><span class="p">()</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>  <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">known_field_names</span><span class="p">:</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child_or_error</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_descendants" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_known_descendants</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_known_descendants" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_known_descendants</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a mapping from known paths to subexpressions.</p>
<p>The difference between this and get_descendants in Prensor is that
all paths in a Prensor are realized, thus all known. But an Expression's
descendants might not all be known at the point this method is called,
because an expression may have an infinite number of children.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>, <a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A mapping from paths (relative to the root of the subexpression) to
expressions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_known_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a>  <span class="c1"># Rename get_known_descendants</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="w">  </span><span class="sd">"""Gets a mapping from known paths to subexpressions.</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">  The difference between this and get_descendants in Prensor is that</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">  all paths in a Prensor are realized, thus all known. But an Expression's</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">  descendants might not all be known at the point this method is called,</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">  because an expression may have an infinite number of children.</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    A mapping from paths (relative to the root of the subexpression) to</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">      expressions.</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">  """</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>  <span class="n">known_subexpressions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>      <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_known_descendants</span><span class="p">()</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_known_children</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>  <span class="p">}</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>  <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">subexpression</span> <span class="ow">in</span> <span class="n">known_subexpressions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">subexpression_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="p">[</span><span class="n">field_name</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="p">)</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">subexpression</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>      <span class="n">result</span><span class="p">[</span><span class="n">subexpression_path</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="o">=</span> <span class="n">expr</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>  <span class="n">result</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_paths_with_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_paths_with_schema</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_paths_with_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_paths_with_schema</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract only paths that contain schema information.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_paths_with_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="w">  </span><span class="sd">"""Extract only paths that contain schema information."""</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a>  <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_known_children</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">schema_feature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>      <span class="k">continue</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="p">[</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="p">)</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">get_paths_with_schema</span><span class="p">()</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="p">]</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="p">)</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a>  <span class="c1"># Note: We always take the root path and so will return an empty schema</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a>  <span class="c1"># if there is no schema information on any nodes, including the root.</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="p">)</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_schema</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_schema</span><span class="p">(</span><span class="n">create_schema_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a schema for the entire tree.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>create_schema_features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, schema features are added for all
children and a schema entry is created if not available on the child. If
False, features are left off of the returned schema if there is no
schema_feature on the child.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">create_schema_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">:</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="w">  </span><span class="sd">"""Returns a schema for the entire tree.</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">  Args:</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    create_schema_features: If True, schema features are added for all</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">      children and a schema entry is created if not available on the child. If</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">      False, features are left off of the returned schema if there is no</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">      schema_feature on the child.</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">  """</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">create_schema_features</span><span class="p">:</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_paths_with_schema</span><span class="p">())</span><span class="o">.</span><span class="n">get_schema</span><span class="p">()</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_populate_schema_feature_children</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.get_source_expressions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_source_expressions</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.get_source_expressions" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_source_expressions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the sources of this expression.</p>
<p>The node tensors of the source expressions must be sufficient to
calculate the node tensor of this expression
(see calculate and calculate_value_slowly).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The sources of this expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_source_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_origin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.known_field_names" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">known_field_names</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.known_field_names" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">known_field_names</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns known field names of the expression.</p>
<p>TODO(martinz): implement set_field and project.
Known field names of a parsed proto correspond to the fields declared in
the message. Examples of "unknown" fields are extensions and explicit casts
in an any field. The only way to know if an unknown field "(foo.bar)" is
present in an expression expr is to call (expr["(foo.bar)"] is not None).</p>
<p>Notice that simply accessing a field does not make it "known". However,
setting a field (or setting a descendant of a field) will make it known.</p>
<p>project(...) returns an expression where the known field names are the only
field names. In general, if you want to depend upon known_field_names
(e.g., if you want to compile a expression), then the best approach is to
project() the expression first.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An immutable set of field names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="k">def</span><span class="w"> </span><span class="nf">known_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenSet</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">]:</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span><span class="o">.</span><span class="n">known_field_names</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.map_field_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_field_values</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.map_field_values" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_field_values</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map a primitive field to create a new primitive field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The dtype argument is added since the v1 API.</p>
</div>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the origin path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an element-wise operator that takes a 1-dimensional vector.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[[<span title="tensorflow.Tensor">Tensor</span>], <span title="tensorflow.Tensor">Tensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the type of the output.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of a new sibling of source_path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the resulting root expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_field_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a>                     <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>                     <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="w">  </span><span class="sd">"""Map a primitive field to create a new primitive field.</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">  !!! Note</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">      The dtype argument is added since the v1 API.</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">  Args:</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    source_path: the origin path.</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    operator: an element-wise operator that takes a 1-dimensional vector.</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    dtype: the type of the output.</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    new_field_name: the name of a new sibling of source_path.</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">    the resulting root expression.</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">  """</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>  <span class="k">return</span> <span class="n">map_values</span><span class="o">.</span><span class="n">map_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>                               <span class="n">dtype</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.map_ragged_tensors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_ragged_tensors</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.map_ragged_tensors" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_ragged_tensors</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a set of primitive fields of a message to a new field.</p>
<p>Unlike map_field_values, this operation allows you to some degree reshape
the field. For instance, you can take two optional fields and create a
repeated field, or perform a reduce_sum on the last dimension of a repeated
field and create an optional field. The key constraint is that the operator
must return a sparse tensor of the correct dimension: i.e., a
2D sparse tensor if is_repeated is true, or a 1D sparse tensor if
is_repeated is false. Moreover, the first dimension of the sparse tensor
must be equal to the first dimension of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parent of the input and output fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the nonempty list of names of the source fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an operator that takes len(source_fields) sparse tensors and
returns a sparse tensor of the appropriate shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the output is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of the result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the resulting field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_ragged_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a>                       <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>                       <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>                       <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="w">  </span><span class="sd">"""Maps a set of primitive fields of a message to a new field.</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">  Unlike map_field_values, this operation allows you to some degree reshape</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">  the field. For instance, you can take two optional fields and create a</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">  repeated field, or perform a reduce_sum on the last dimension of a repeated</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">  field and create an optional field. The key constraint is that the operator</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">  must return a sparse tensor of the correct dimension: i.e., a</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">  2D sparse tensor if is_repeated is true, or a 1D sparse tensor if</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">  is_repeated is false. Moreover, the first dimension of the sparse tensor</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">  must be equal to the first dimension of the input tensor.</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">  Args:</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    parent_path: the parent of the input and output fields.</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    source_fields: the nonempty list of names of the source fields.</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    operator: an operator that takes len(source_fields) sparse tensors and</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">      returns a sparse tensor of the appropriate shape.</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    is_repeated: whether the output is repeated.</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    dtype: the dtype of the result.</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    new_field_name: the name of the resulting field.</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">    A new query.</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">  """</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>  <span class="k">return</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_ragged_tensor</span><span class="p">(</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>      <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">),</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>      <span class="p">[</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>          <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>      <span class="p">],</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>      <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>      <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>      <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a>      <span class="n">new_field_name</span><span class="p">,</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a>  <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.map_sparse_tensors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_sparse_tensors</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.map_sparse_tensors" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_sparse_tensors</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a set of primitive fields of a message to a new field.</p>
<p>Unlike map_field_values, this operation allows you to some degree reshape
the field. For instance, you can take two optional fields and create a
repeated field, or perform a reduce_sum on the last dimension of a repeated
field and create an optional field. The key constraint is that the operator
must return a sparse tensor of the correct dimension: i.e., a
2D sparse tensor if is_repeated is true, or a 1D sparse tensor if
is_repeated is false. Moreover, the first dimension of the sparse tensor
must be equal to the first dimension of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parent of the input and output fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the nonempty list of names of the source fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an operator that takes len(source_fields) sparse tensors and
returns a sparse tensor of the appropriate shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the output is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of the result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the resulting field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_sparse_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>                       <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>                       <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>                       <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="w">  </span><span class="sd">"""Maps a set of primitive fields of a message to a new field.</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">  Unlike map_field_values, this operation allows you to some degree reshape</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">  the field. For instance, you can take two optional fields and create a</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">  repeated field, or perform a reduce_sum on the last dimension of a repeated</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">  field and create an optional field. The key constraint is that the operator</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">  must return a sparse tensor of the correct dimension: i.e., a</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">  2D sparse tensor if is_repeated is true, or a 1D sparse tensor if</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">  is_repeated is false. Moreover, the first dimension of the sparse tensor</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">  must be equal to the first dimension of the input tensor.</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">  Args:</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    parent_path: the parent of the input and output fields.</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    source_fields: the nonempty list of names of the source fields.</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    operator: an operator that takes len(source_fields) sparse tensors and</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">      returns a sparse tensor of the appropriate shape.</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    is_repeated: whether the output is repeated.</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    dtype: the dtype of the result.</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    new_field_name: the name of the resulting field.</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    A new query.</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">  """</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a>  <span class="k">return</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_sparse_tensor</span><span class="p">(</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>      <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">),</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>      <span class="p">[</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>          <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a>          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>      <span class="p">],</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a>      <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a>      <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>      <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a>      <span class="n">new_field_name</span><span class="p">,</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a>  <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.project" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">project</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.project" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">project</span><span class="p">(</span><span class="n">path_list</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Constrains the paths to those listed.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_list</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">CoercableToPath</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="w">  </span><span class="sd">"""Constrains the paths to those listed."""</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>  <span class="k">return</span> <span class="n">project</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.promote" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.promote" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote</span><span class="p">(</span><span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promotes source_path to be a field new_field_name in its grandparent.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">):</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="w">  </span><span class="sd">"""Promotes source_path to be a field new_field_name in its grandparent."""</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>  <span class="k">return</span> <span class="n">promote</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.promote_and_broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote_and_broadcast</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.promote_and_broadcast" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">path_dictionary</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">path_dictionary</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">CoercableToPath</span><span class="p">],</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>  <span class="k">return</span> <span class="n">promote_and_broadcast</span><span class="o">.</span><span class="n">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>      <span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">path_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">dest_path_parent</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.reroot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reroot</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.reroot" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reroot</span><span class="p">(</span><span class="n">new_root</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a new list of protocol buffers available at new_root.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="k">def</span><span class="w"> </span><span class="nf">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_root</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="w">  </span><span class="sd">"""Returns a new list of protocol buffers available at new_root."""</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>  <span class="k">return</span> <span class="n">reroot</span><span class="o">.</span><span class="n">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">new_root</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.schema_string" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">schema_string</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.schema_string" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">schema_string</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a schema for the expression.</p>
<p>For examle,
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>repeated root:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  optional int32 foo
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  optional bar:
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    optional string baz
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  optional int64 bak
</span></code></pre></div>
<p>Note that unknown fields and subexpressions are not displayed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if present, limit the recursion.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A string, describing (a part of) the schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="k">def</span><span class="w"> </span><span class="nf">schema_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="w">  </span><span class="sd">"""Returns a schema for the expression.</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">  For examle,</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">  ```</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">  repeated root:</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    optional int32 foo</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    optional bar:</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">      optional string baz</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    optional int64 bak</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">  ```</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">  Note that unknown fields and subexpressions are not displayed.</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">  Args:</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">    limit: if present, limit the recursion.</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    A string, describing (a part of) the schema.</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">  """</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>  <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schema_string_helper</span><span class="p">(</span><span class="s2">"root"</span><span class="p">,</span> <span class="n">limit</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.slice" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">slice</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.slice" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">slice</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">begin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">end</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a slice copy of source_path at new_field_path.</p>
<p>Note that if begin or end is negative, it is considered relative to
the size of the array. e.g., slice(...,begin=-1) will get the last
element of every array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the source of the slice.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the new field that is generated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>begin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the beginning of the slice (inclusive).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.expression.IndexValue">IndexValue</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the end of the slice (exclusive).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.expression.IndexValue">IndexValue</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An Expression object representing the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="k">def</span><span class="w"> </span><span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>          <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>          <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>          <span class="n">begin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>          <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="w">  </span><span class="sd">"""Creates a slice copy of source_path at new_field_path.</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">  Note that if begin or end is negative, it is considered relative to</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">  the size of the array. e.g., slice(...,begin=-1) will get the last</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">  element of every array.</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">  Args:</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    source_path: the source of the slice.</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    new_field_name: the new field that is generated.</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    begin: the beginning of the slice (inclusive).</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    end: the end of the slice (exclusive).</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    An Expression object representing the result of the operation.</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">  """</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a>  <span class="k">return</span> <span class="n">slice_expression</span><span class="o">.</span><span class="n">slice_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a>                                           <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a>                                           <span class="n">new_field_name</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteChildExpression.truncate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">truncate</span>


<a href="#struct2tensor.expression_impl.promote.PromoteChildExpression.truncate" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">truncate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a truncated copy of source_path at new_field_path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="k">def</span><span class="w"> </span><span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>             <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="w">  </span><span class="sd">"""Creates a truncated copy of source_path at new_field_path."""</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="struct2tensor.expression_impl.promote.PromoteExpression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PromoteExpression</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">PromoteExpression</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">origin_parent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="struct2tensor.expression.Leaf">Leaf</span></code></p>


        <p>A promoted leaf.</p>

        <p>Initialize a Leaf.</p>
<p>Note that a leaf must have a specified type.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if the expression is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>my_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the DType of the field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_feature</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>schema information about the field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply (struct2tensor.expression_impl.promote.PromoteExpression.apply)" href="#struct2tensor.expression_impl.promote.PromoteExpression.apply">apply</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply_schema (struct2tensor.expression_impl.promote.PromoteExpression.apply_schema)" href="#struct2tensor.expression_impl.promote.PromoteExpression.apply_schema">apply_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            broadcast (struct2tensor.expression_impl.promote.PromoteExpression.broadcast)" href="#struct2tensor.expression_impl.promote.PromoteExpression.broadcast">broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Broadcasts the existing field at source_path to the sibling_field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculate (struct2tensor.expression_impl.promote.PromoteExpression.calculate)" href="#struct2tensor.expression_impl.promote.PromoteExpression.calculate">calculate</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculates the node tensor of the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculation_equal (struct2tensor.expression_impl.promote.PromoteExpression.calculation_equal)" href="#struct2tensor.expression_impl.promote.PromoteExpression.calculation_equal">calculation_equal</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>self.calculate is equal to another expression.calculate.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculation_is_identity (struct2tensor.expression_impl.promote.PromoteExpression.calculation_is_identity)" href="#struct2tensor.expression_impl.promote.PromoteExpression.calculation_is_identity">calculation_is_identity</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>True iff the self.calculate is the identity.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            cogroup_by_index (struct2tensor.expression_impl.promote.PromoteExpression.cogroup_by_index)" href="#struct2tensor.expression_impl.promote.PromoteExpression.cogroup_by_index">cogroup_by_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a cogroup of left_name and right_name at new_field_name.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_has_field (struct2tensor.expression_impl.promote.PromoteExpression.create_has_field)" href="#struct2tensor.expression_impl.promote.PromoteExpression.create_has_field">create_has_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a field that is the presence of the source path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_proto_index (struct2tensor.expression_impl.promote.PromoteExpression.create_proto_index)" href="#struct2tensor.expression_impl.promote.PromoteExpression.create_proto_index">create_proto_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a proto index field as a direct child of the current root.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_size_field (struct2tensor.expression_impl.promote.PromoteExpression.create_size_field)" href="#struct2tensor.expression_impl.promote.PromoteExpression.create_size_field">create_size_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a field that is the size of the source path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child (struct2tensor.expression_impl.promote.PromoteExpression.get_child)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_child">get_child</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a named child.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child_or_error (struct2tensor.expression_impl.promote.PromoteExpression.get_child_or_error)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_child_or_error">get_child_or_error</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a named child.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_descendant (struct2tensor.expression_impl.promote.PromoteExpression.get_descendant)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_descendant">get_descendant</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Finds the descendant at the path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_descendant_or_error (struct2tensor.expression_impl.promote.PromoteExpression.get_descendant_or_error)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_descendant_or_error">get_descendant_or_error</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Finds the descendant at the path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_known_children (struct2tensor.expression_impl.promote.PromoteExpression.get_known_children)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_known_children">get_known_children</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_known_descendants (struct2tensor.expression_impl.promote.PromoteExpression.get_known_descendants)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_known_descendants">get_known_descendants</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a mapping from known paths to subexpressions.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_paths_with_schema (struct2tensor.expression_impl.promote.PromoteExpression.get_paths_with_schema)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_paths_with_schema">get_paths_with_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Extract only paths that contain schema information.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_schema (struct2tensor.expression_impl.promote.PromoteExpression.get_schema)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_schema">get_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a schema for the entire tree.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_source_expressions (struct2tensor.expression_impl.promote.PromoteExpression.get_source_expressions)" href="#struct2tensor.expression_impl.promote.PromoteExpression.get_source_expressions">get_source_expressions</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets the sources of this expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            known_field_names (struct2tensor.expression_impl.promote.PromoteExpression.known_field_names)" href="#struct2tensor.expression_impl.promote.PromoteExpression.known_field_names">known_field_names</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns known field names of the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_field_values (struct2tensor.expression_impl.promote.PromoteExpression.map_field_values)" href="#struct2tensor.expression_impl.promote.PromoteExpression.map_field_values">map_field_values</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map a primitive field to create a new primitive field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_ragged_tensors (struct2tensor.expression_impl.promote.PromoteExpression.map_ragged_tensors)" href="#struct2tensor.expression_impl.promote.PromoteExpression.map_ragged_tensors">map_ragged_tensors</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a set of primitive fields of a message to a new field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_sparse_tensors (struct2tensor.expression_impl.promote.PromoteExpression.map_sparse_tensors)" href="#struct2tensor.expression_impl.promote.PromoteExpression.map_sparse_tensors">map_sparse_tensors</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a set of primitive fields of a message to a new field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            project (struct2tensor.expression_impl.promote.PromoteExpression.project)" href="#struct2tensor.expression_impl.promote.PromoteExpression.project">project</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Constrains the paths to those listed.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote (struct2tensor.expression_impl.promote.PromoteExpression.promote)" href="#struct2tensor.expression_impl.promote.PromoteExpression.promote">promote</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promotes source_path to be a field new_field_name in its grandparent.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote_and_broadcast (struct2tensor.expression_impl.promote.PromoteExpression.promote_and_broadcast)" href="#struct2tensor.expression_impl.promote.PromoteExpression.promote_and_broadcast">promote_and_broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            reroot (struct2tensor.expression_impl.promote.PromoteExpression.reroot)" href="#struct2tensor.expression_impl.promote.PromoteExpression.reroot">reroot</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a new list of protocol buffers available at new_root.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            schema_string (struct2tensor.expression_impl.promote.PromoteExpression.schema_string)" href="#struct2tensor.expression_impl.promote.PromoteExpression.schema_string">schema_string</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a schema for the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            slice (struct2tensor.expression_impl.promote.PromoteExpression.slice)" href="#struct2tensor.expression_impl.promote.PromoteExpression.slice">slice</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a slice copy of source_path at new_field_path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            truncate (struct2tensor.expression_impl.promote.PromoteExpression.truncate)" href="#struct2tensor.expression_impl.promote.PromoteExpression.truncate">truncate</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a truncated copy of source_path at new_field_path.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_leaf


  
      property
   (struct2tensor.expression_impl.promote.PromoteExpression.is_leaf)" href="#struct2tensor.expression_impl.promote.PromoteExpression.is_leaf">is_leaf</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>True iff the node tensor is a LeafNodeTensor.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_repeated


  
      property
   (struct2tensor.expression_impl.promote.PromoteExpression.is_repeated)" href="#struct2tensor.expression_impl.promote.PromoteExpression.is_repeated">is_repeated</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>True iff the same parent value can have multiple children values.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            schema_feature


  
      property
   (struct2tensor.expression_impl.promote.PromoteExpression.schema_feature)" href="#struct2tensor.expression_impl.promote.PromoteExpression.schema_feature">schema_feature</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Return the schema of the field.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            type


  
      property
   (struct2tensor.expression_impl.promote.PromoteExpression.type)" href="#struct2tensor.expression_impl.promote.PromoteExpression.type">type</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>dtype of the expression, or None if not a leaf expression.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            validate_step_format


  
      property
   (struct2tensor.expression_impl.promote.PromoteExpression.validate_step_format)" href="#struct2tensor.expression_impl.promote.PromoteExpression.validate_step_format">validate_step_format</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

                  <details class="quote">
                    <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>             <span class="n">origin_parent</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>  <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>      <span class="n">origin</span><span class="o">.</span><span class="n">is_repeated</span> <span class="ow">or</span> <span class="n">origin_parent</span><span class="o">.</span><span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>      <span class="n">origin</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>      <span class="n">schema_feature</span><span class="o">=</span><span class="n">_get_promote_schema_feature</span><span class="p">(</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>          <span class="n">origin</span><span class="o">.</span><span class="n">schema_feature</span><span class="p">,</span> <span class="n">origin_parent</span><span class="o">.</span><span class="n">schema_feature</span><span class="p">))</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">origin</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span> <span class="o">=</span> <span class="n">origin_parent</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Can only promote a field"</span><span class="p">)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_parent cannot be a field"</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">





<h7 id="struct2tensor.expression_impl.promote.PromoteExpression-attributes">Attributes<a href="#struct2tensor.expression_impl.promote.PromoteExpression-attributes" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.is_leaf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_leaf</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteExpression.is_leaf" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_leaf</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the node tensor is a LeafNodeTensor.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.is_repeated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_repeated</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteExpression.is_repeated" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the same parent value can have multiple children values.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.schema_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">schema_feature</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteExpression.schema_feature" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">schema_feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the schema of the field.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.type" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">type</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteExpression.type" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>dtype of the expression, or None if not a leaf expression.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.validate_step_format" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">validate_step_format</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.promote.PromoteExpression.validate_step_format" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">validate_step_format</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h7 id="struct2tensor.expression_impl.promote.PromoteExpression-functions">Functions<a href="#struct2tensor.expression_impl.promote.PromoteExpression-functions" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.apply" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">apply</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.apply" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">transform</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>          <span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="s2">"Expression"</span><span class="p">],</span> <span class="s2">"Expression"</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>  <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.apply_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">apply_schema</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.apply_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>  <span class="k">return</span> <span class="n">apply_schema</span><span class="o">.</span><span class="n">apply_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">broadcast</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.broadcast" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">sibling_field</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Broadcasts the existing field at source_path to the sibling_field.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="k">def</span><span class="w"> </span><span class="nf">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">sibling_field</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>              <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="w">  </span><span class="sd">"""Broadcasts the existing field at source_path to the sibling_field."""</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>  <span class="k">return</span> <span class="n">broadcast</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>                             <span class="n">sibling_field</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.calculate" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">sources</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">destinations</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">options</span><span class="p">:</span> <span class="n"><span title="struct2tensor.calculate_options.Options">Options</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">side_info</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculates the node tensor of the expression.</p>
<p>The node tensor must be a function of the properties of the expression
and the node tensors of the expressions from get_source_expressions().</p>
<p>If is_leaf, then calculate must return a LeafNodeTensor.
Otherwise, it must return a ChildNodeTensor or RootNodeTensor.</p>
<p>If calculate_is_identity is true, then this must return source_tensors[0].</p>
<p>Sometimes, for operations such as parsing the proto, calculate will return
additional information. For example, calculate() for the root of the
proto expression also parses out the tensors required to calculate the
tensors of the children. This is why destinations are required.</p>
<p>For a reference use, see calculate_value_slowly(...) below.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_tensors</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The node tensors of the expressions in
get_source_expressions().</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destinations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expressions that will use the output of this method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Options for the calculation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.calculate_options.Options">Options</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>side_info</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An optional prensor that is used to bind to a placeholder
expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A NodeTensor representing the output of this expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">sources</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">prensor</span><span class="o">.</span><span class="n">NodeTensor</span><span class="p">],</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">destinations</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">],</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">options</span><span class="p">:</span> <span class="n">calculate_options</span><span class="o">.</span><span class="n">Options</span><span class="p">,</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">side_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prensor</span><span class="o">.</span><span class="n">Prensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">prensor</span><span class="o">.</span><span class="n">NodeTensor</span><span class="p">:</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>  <span class="p">[</span><span class="n">origin_value</span><span class="p">,</span> <span class="n">origin_parent_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin_value</span><span class="p">,</span> <span class="n">prensor</span><span class="o">.</span><span class="n">LeafNodeTensor</span><span class="p">):</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_value must be a leaf"</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin_parent_value</span><span class="p">,</span> <span class="n">prensor</span><span class="o">.</span><span class="n">ChildNodeTensor</span><span class="p">):</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_parent_value must be a child node"</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>  <span class="n">new_parent_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">origin_parent_value</span><span class="o">.</span><span class="n">parent_index</span><span class="p">,</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>                               <span class="n">origin_value</span><span class="o">.</span><span class="n">parent_index</span><span class="p">)</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>  <span class="k">return</span> <span class="n">prensor</span><span class="o">.</span><span class="n">LeafNodeTensor</span><span class="p">(</span><span class="n">new_parent_index</span><span class="p">,</span> <span class="n">origin_value</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">is_repeated</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.calculation_equal" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculation_equal</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.calculation_equal" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculation_equal</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>self.calculate is equal to another expression.calculate.</p>
<p>Given the same source node tensors, self.calculate(...) and
expression.calculate(...) will have the same result.</p>
<p>Note that this does not check that the source expressions of the two
expressions are the same. Therefore, two operations can have the same
calculation, but not the same output, because their sources are different.
For example, if a.calculation_is_identity() is True and
b.calculation_is_identity() is True, then a.calculation_equal(b) is True.
However, unless a and b have the same source, the expressions themselves are
not equal.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expression</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expression to compare to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculation_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">PromoteExpression</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.calculation_is_identity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculation_is_identity</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.calculation_is_identity" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculation_is_identity</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the self.calculate is the identity.</p>
<p>There is exactly one source, and the output of self.calculate(...) is the
node tensor of this source.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculation_is_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>  <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.cogroup_by_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">cogroup_by_index</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.cogroup_by_index" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">cogroup_by_index</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">left_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">right_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a cogroup of left_name and right_name at new_field_name.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="k">def</span><span class="w"> </span><span class="nf">cogroup_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">left_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>                     <span class="n">right_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="w">  </span><span class="sd">"""Creates a cogroup of left_name and right_name at new_field_name."""</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"cogroup_by_index is not implemented"</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.create_has_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_has_field</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.create_has_field" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_has_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a field that is the presence of the source path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_has_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="w">  </span><span class="sd">"""Creates a field that is the presence of the source path."""</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>  <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.create_proto_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_proto_index</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.create_proto_index" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_proto_index</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a proto index field as a direct child of the current root.</p>
<p>The proto index maps each root element to the original batch index.
For example: [0, 2] means the first element came from the first proto
in the original input tensor and the second element came from the third
proto. The created field is always "dense" -- it has the same valency as
the current root.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the field to be created.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An Expression object representing the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_proto_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="w">  </span><span class="sd">"""Creates a proto index field as a direct child of the current root.</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">  The proto index maps each root element to the original batch index.</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">  For example: [0, 2] means the first element came from the first proto</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">  in the original input tensor and the second element came from the third</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">  proto. The created field is always "dense" -- it has the same valency as</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">  the current root.</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">  Args:</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    field_name: the name of the field to be created.</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    An Expression object representing the result of the operation.</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">  """</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>  <span class="k">return</span> <span class="n">reroot</span><span class="o">.</span><span class="n">create_proto_index_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.create_size_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_size_field</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.create_size_field" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_size_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a field that is the size of the source path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_size_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>                      <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="w">  </span><span class="sd">"""Creates a field that is the size of the source path."""</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>  <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_child" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_child" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a named child.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="w">  </span><span class="sd">"""Gets a named child."""</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>  <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">:</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_child_impl</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_child_or_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child_or_error</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_child_or_error" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child_or_error</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a named child.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child_or_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="w">  </span><span class="sd">"""Gets a named child."""</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"No such field: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_name</span><span class="p">))</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_descendant" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_descendant</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_descendant" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the descendant at the path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="w">  </span><span class="sd">"""Finds the descendant at the path."""</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>  <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">field_list</span><span class="p">:</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>      <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_descendant_or_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_descendant_or_error</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_descendant_or_error" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_descendant_or_error</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the descendant at the path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descendant_or_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">  </span><span class="sd">"""Finds the descendant at the path."""</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Missing path: </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_string</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)))</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_known_children" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_known_children</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_known_children" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_known_children</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_known_children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>  <span class="n">known_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_field_names</span><span class="p">()</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>  <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">known_field_names</span><span class="p">:</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child_or_error</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_known_descendants" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_known_descendants</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_known_descendants" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_known_descendants</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a mapping from known paths to subexpressions.</p>
<p>The difference between this and get_descendants in Prensor is that
all paths in a Prensor are realized, thus all known. But an Expression's
descendants might not all be known at the point this method is called,
because an expression may have an infinite number of children.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>, <a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A mapping from paths (relative to the root of the subexpression) to
expressions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_known_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a>  <span class="c1"># Rename get_known_descendants</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="w">  </span><span class="sd">"""Gets a mapping from known paths to subexpressions.</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">  The difference between this and get_descendants in Prensor is that</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">  all paths in a Prensor are realized, thus all known. But an Expression's</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">  descendants might not all be known at the point this method is called,</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">  because an expression may have an infinite number of children.</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    A mapping from paths (relative to the root of the subexpression) to</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">      expressions.</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">  """</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>  <span class="n">known_subexpressions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>      <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_known_descendants</span><span class="p">()</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_known_children</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>  <span class="p">}</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>  <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">subexpression</span> <span class="ow">in</span> <span class="n">known_subexpressions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">subexpression_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="p">[</span><span class="n">field_name</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="p">)</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">subexpression</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>      <span class="n">result</span><span class="p">[</span><span class="n">subexpression_path</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="o">=</span> <span class="n">expr</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>  <span class="n">result</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_paths_with_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_paths_with_schema</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_paths_with_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_paths_with_schema</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract only paths that contain schema information.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_paths_with_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="w">  </span><span class="sd">"""Extract only paths that contain schema information."""</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a>  <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_known_children</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">schema_feature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>      <span class="k">continue</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="p">[</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="p">)</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">get_paths_with_schema</span><span class="p">()</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="p">]</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="p">)</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a>  <span class="c1"># Note: We always take the root path and so will return an empty schema</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a>  <span class="c1"># if there is no schema information on any nodes, including the root.</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="p">)</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_schema</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_schema</span><span class="p">(</span><span class="n">create_schema_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a schema for the entire tree.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>create_schema_features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, schema features are added for all
children and a schema entry is created if not available on the child. If
False, features are left off of the returned schema if there is no
schema_feature on the child.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">create_schema_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">:</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="w">  </span><span class="sd">"""Returns a schema for the entire tree.</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">  Args:</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    create_schema_features: If True, schema features are added for all</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">      children and a schema entry is created if not available on the child. If</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">      False, features are left off of the returned schema if there is no</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">      schema_feature on the child.</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">  """</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">create_schema_features</span><span class="p">:</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_paths_with_schema</span><span class="p">())</span><span class="o">.</span><span class="n">get_schema</span><span class="p">()</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_populate_schema_feature_children</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.get_source_expressions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_source_expressions</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.get_source_expressions" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_source_expressions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the sources of this expression.</p>
<p>The node tensors of the source expressions must be sufficient to
calculate the node tensor of this expression
(see calculate and calculate_value_slowly).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The sources of this expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_source_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_origin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.known_field_names" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">known_field_names</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.known_field_names" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">known_field_names</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns known field names of the expression.</p>
<p>TODO(martinz): implement set_field and project.
Known field names of a parsed proto correspond to the fields declared in
the message. Examples of "unknown" fields are extensions and explicit casts
in an any field. The only way to know if an unknown field "(foo.bar)" is
present in an expression expr is to call (expr["(foo.bar)"] is not None).</p>
<p>Notice that simply accessing a field does not make it "known". However,
setting a field (or setting a descendant of a field) will make it known.</p>
<p>project(...) returns an expression where the known field names are the only
field names. In general, if you want to depend upon known_field_names
(e.g., if you want to compile a expression), then the best approach is to
project() the expression first.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An immutable set of field names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="k">def</span><span class="w"> </span><span class="nf">known_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenSet</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">]:</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a>  <span class="k">return</span> <span class="nb">frozenset</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.map_field_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_field_values</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.map_field_values" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_field_values</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map a primitive field to create a new primitive field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The dtype argument is added since the v1 API.</p>
</div>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the origin path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an element-wise operator that takes a 1-dimensional vector.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[[<span title="tensorflow.Tensor">Tensor</span>], <span title="tensorflow.Tensor">Tensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the type of the output.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of a new sibling of source_path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the resulting root expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_field_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a>                     <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>                     <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="w">  </span><span class="sd">"""Map a primitive field to create a new primitive field.</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">  !!! Note</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">      The dtype argument is added since the v1 API.</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">  Args:</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    source_path: the origin path.</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    operator: an element-wise operator that takes a 1-dimensional vector.</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    dtype: the type of the output.</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    new_field_name: the name of a new sibling of source_path.</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">    the resulting root expression.</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">  """</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>  <span class="k">return</span> <span class="n">map_values</span><span class="o">.</span><span class="n">map_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>                               <span class="n">dtype</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.map_ragged_tensors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_ragged_tensors</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.map_ragged_tensors" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_ragged_tensors</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a set of primitive fields of a message to a new field.</p>
<p>Unlike map_field_values, this operation allows you to some degree reshape
the field. For instance, you can take two optional fields and create a
repeated field, or perform a reduce_sum on the last dimension of a repeated
field and create an optional field. The key constraint is that the operator
must return a sparse tensor of the correct dimension: i.e., a
2D sparse tensor if is_repeated is true, or a 1D sparse tensor if
is_repeated is false. Moreover, the first dimension of the sparse tensor
must be equal to the first dimension of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parent of the input and output fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the nonempty list of names of the source fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an operator that takes len(source_fields) sparse tensors and
returns a sparse tensor of the appropriate shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the output is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of the result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the resulting field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_ragged_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a>                       <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>                       <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>                       <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="w">  </span><span class="sd">"""Maps a set of primitive fields of a message to a new field.</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">  Unlike map_field_values, this operation allows you to some degree reshape</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">  the field. For instance, you can take two optional fields and create a</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">  repeated field, or perform a reduce_sum on the last dimension of a repeated</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">  field and create an optional field. The key constraint is that the operator</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">  must return a sparse tensor of the correct dimension: i.e., a</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">  2D sparse tensor if is_repeated is true, or a 1D sparse tensor if</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">  is_repeated is false. Moreover, the first dimension of the sparse tensor</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">  must be equal to the first dimension of the input tensor.</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">  Args:</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    parent_path: the parent of the input and output fields.</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    source_fields: the nonempty list of names of the source fields.</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    operator: an operator that takes len(source_fields) sparse tensors and</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">      returns a sparse tensor of the appropriate shape.</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    is_repeated: whether the output is repeated.</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    dtype: the dtype of the result.</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    new_field_name: the name of the resulting field.</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">    A new query.</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">  """</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>  <span class="k">return</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_ragged_tensor</span><span class="p">(</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>      <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">),</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>      <span class="p">[</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>          <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>      <span class="p">],</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>      <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>      <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>      <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a>      <span class="n">new_field_name</span><span class="p">,</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a>  <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.map_sparse_tensors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_sparse_tensors</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.map_sparse_tensors" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_sparse_tensors</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a set of primitive fields of a message to a new field.</p>
<p>Unlike map_field_values, this operation allows you to some degree reshape
the field. For instance, you can take two optional fields and create a
repeated field, or perform a reduce_sum on the last dimension of a repeated
field and create an optional field. The key constraint is that the operator
must return a sparse tensor of the correct dimension: i.e., a
2D sparse tensor if is_repeated is true, or a 1D sparse tensor if
is_repeated is false. Moreover, the first dimension of the sparse tensor
must be equal to the first dimension of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parent of the input and output fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the nonempty list of names of the source fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an operator that takes len(source_fields) sparse tensors and
returns a sparse tensor of the appropriate shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the output is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of the result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the resulting field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_sparse_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>                       <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>                       <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>                       <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="w">  </span><span class="sd">"""Maps a set of primitive fields of a message to a new field.</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">  Unlike map_field_values, this operation allows you to some degree reshape</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">  the field. For instance, you can take two optional fields and create a</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">  repeated field, or perform a reduce_sum on the last dimension of a repeated</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">  field and create an optional field. The key constraint is that the operator</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">  must return a sparse tensor of the correct dimension: i.e., a</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">  2D sparse tensor if is_repeated is true, or a 1D sparse tensor if</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">  is_repeated is false. Moreover, the first dimension of the sparse tensor</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">  must be equal to the first dimension of the input tensor.</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">  Args:</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    parent_path: the parent of the input and output fields.</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    source_fields: the nonempty list of names of the source fields.</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    operator: an operator that takes len(source_fields) sparse tensors and</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">      returns a sparse tensor of the appropriate shape.</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    is_repeated: whether the output is repeated.</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    dtype: the dtype of the result.</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    new_field_name: the name of the resulting field.</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    A new query.</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">  """</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a>  <span class="k">return</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_sparse_tensor</span><span class="p">(</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>      <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">),</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>      <span class="p">[</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>          <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a>          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>      <span class="p">],</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a>      <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a>      <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>      <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a>      <span class="n">new_field_name</span><span class="p">,</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a>  <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.project" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">project</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.project" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">project</span><span class="p">(</span><span class="n">path_list</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Constrains the paths to those listed.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_list</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">CoercableToPath</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="w">  </span><span class="sd">"""Constrains the paths to those listed."""</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>  <span class="k">return</span> <span class="n">project</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.promote" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.promote" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote</span><span class="p">(</span><span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promotes source_path to be a field new_field_name in its grandparent.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">):</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="w">  </span><span class="sd">"""Promotes source_path to be a field new_field_name in its grandparent."""</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>  <span class="k">return</span> <span class="n">promote</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.promote_and_broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote_and_broadcast</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.promote_and_broadcast" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">path_dictionary</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">path_dictionary</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">CoercableToPath</span><span class="p">],</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>  <span class="k">return</span> <span class="n">promote_and_broadcast</span><span class="o">.</span><span class="n">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>      <span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">path_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">dest_path_parent</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.reroot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reroot</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.reroot" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reroot</span><span class="p">(</span><span class="n">new_root</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a new list of protocol buffers available at new_root.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="k">def</span><span class="w"> </span><span class="nf">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_root</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="w">  </span><span class="sd">"""Returns a new list of protocol buffers available at new_root."""</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>  <span class="k">return</span> <span class="n">reroot</span><span class="o">.</span><span class="n">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">new_root</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.schema_string" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">schema_string</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.schema_string" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">schema_string</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a schema for the expression.</p>
<p>For examle,
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>repeated root:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  optional int32 foo
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  optional bar:
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    optional string baz
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  optional int64 bak
</span></code></pre></div>
<p>Note that unknown fields and subexpressions are not displayed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if present, limit the recursion.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A string, describing (a part of) the schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="k">def</span><span class="w"> </span><span class="nf">schema_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="w">  </span><span class="sd">"""Returns a schema for the expression.</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">  For examle,</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">  ```</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">  repeated root:</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    optional int32 foo</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    optional bar:</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">      optional string baz</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    optional int64 bak</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">  ```</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">  Note that unknown fields and subexpressions are not displayed.</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">  Args:</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">    limit: if present, limit the recursion.</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    A string, describing (a part of) the schema.</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">  """</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>  <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schema_string_helper</span><span class="p">(</span><span class="s2">"root"</span><span class="p">,</span> <span class="n">limit</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.slice" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">slice</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.slice" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">slice</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">begin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">end</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a slice copy of source_path at new_field_path.</p>
<p>Note that if begin or end is negative, it is considered relative to
the size of the array. e.g., slice(...,begin=-1) will get the last
element of every array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the source of the slice.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the new field that is generated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>begin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the beginning of the slice (inclusive).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.expression.IndexValue">IndexValue</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the end of the slice (exclusive).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.expression.IndexValue">IndexValue</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An Expression object representing the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="k">def</span><span class="w"> </span><span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>          <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>          <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>          <span class="n">begin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>          <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="w">  </span><span class="sd">"""Creates a slice copy of source_path at new_field_path.</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">  Note that if begin or end is negative, it is considered relative to</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">  the size of the array. e.g., slice(...,begin=-1) will get the last</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">  element of every array.</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">  Args:</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    source_path: the source of the slice.</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    new_field_name: the new field that is generated.</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    begin: the beginning of the slice (inclusive).</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    end: the end of the slice (exclusive).</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    An Expression object representing the result of the operation.</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">  """</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a>  <span class="k">return</span> <span class="n">slice_expression</span><span class="o">.</span><span class="n">slice_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a>                                           <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a>                                           <span class="n">new_field_name</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.promote.PromoteExpression.truncate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">truncate</span>


<a href="#struct2tensor.expression_impl.promote.PromoteExpression.truncate" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">truncate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a truncated copy of source_path at new_field_path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="k">def</span><span class="w"> </span><span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>             <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="w">  </span><span class="sd">"""Creates a truncated copy of source_path at new_field_path."""</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h5 id="struct2tensor.expression_impl.promote-functions">Functions<a href="#struct2tensor.expression_impl.promote-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.promote.promote" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">promote</span>


<a href="#struct2tensor.expression_impl.promote.promote" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promote a path to be a child of its grandparent, and give it a name.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="w">  </span><span class="sd">"""Promote a path to be a child of its grandparent, and give it a name."""</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a>  <span class="k">return</span> <span class="n">_promote_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.promote.promote_anonymous" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">promote_anonymous</span>


<a href="#struct2tensor.expression_impl.promote.promote_anonymous" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_anonymous</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promote a path to be a new anonymous child of its grandparent.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_anonymous</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a>                      <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="w">  </span><span class="sd">"""Promote a path to be a new anonymous child of its grandparent."""</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a>  <span class="k">return</span> <span class="n">_promote_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">get_anonymous_field</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.promote-modules">Modules<a href="#struct2tensor.expression_impl.promote-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.promote_and_broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">promote_and_broadcast</span>


<a href="#struct2tensor.expression_impl.promote_and_broadcast" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>promote_and_broadcast a set of nodes.</p>
<p>For example, suppose an expr represents:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>+
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>|
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>+-session*   (stars indicate repeated)
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>     |
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>     +-event*
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>     |   |
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>     |   +-val*-int64
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>     |
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>     +-user_info? (question mark indicates optional)
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>           |
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>           +-age? int64
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="err">user_i</span><span class="kc">nf</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="err">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="p">}</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">  </span><span class="err">user_i</span><span class="kc">nf</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="err">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">promote_and_broadcast</span><span class="o">.</span><span class="n">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"event"</span><span class="p">]),{</span><span class="s2">"nage"</span><span class="p">:</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"user_info"</span><span class="p">,</span><span class="s2">"age"</span><span class="p">])})</span>
</span></code></pre></div>
<p>creates:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>+
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>|
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>+-session*   (stars indicate repeated)
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>     |
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>     +-event*
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>     |   |
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>     |   +-val*-int64
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>     |   |
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>     |   +-nage*-int64
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>     |
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>     +-user_info? (question mark indicates optional)
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>           |
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>           +-age? int64
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="kc">na</span><span class="err">ge</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="kc">na</span><span class="err">ge</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="err">user_i</span><span class="kc">nf</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="err">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="p">}</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="err">sessio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">    </span><span class="kc">na</span><span class="err">ge</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="err">eve</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="kc">na</span><span class="err">ge</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="err">val</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">  </span><span class="err">user_i</span><span class="kc">nf</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="err">age</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="p">}</span>
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote_and_broadcast (struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast)" href="#struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast">promote_and_broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promote and broadcast a set of paths to a particular location.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote_and_broadcast_anonymous (struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast_anonymous)" href="#struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast_anonymous">promote_and_broadcast_anonymous</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promotes then broadcasts the origin until its parent is new_parent.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.promote_and_broadcast-functions">Functions<a href="#struct2tensor.expression_impl.promote_and_broadcast-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">promote_and_broadcast</span>


<a href="#struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">path_dictionary</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promote and broadcast a set of paths to a particular location.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_dictionary</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a map from destination fields to origin paths.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>, <a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dest_path_parent</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a map from destination strings.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new expression, where all the origin paths are promoted and broadcast
until they are children of dest_path_parent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote_and_broadcast.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_and_broadcast</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>                          <span class="n">path_dictionary</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>                          <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">  </span><span class="sd">"""Promote and broadcast a set of paths to a particular location.</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">  Args:</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    root: the original expression.</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    path_dictionary: a map from destination fields to origin paths.</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    dest_path_parent: a map from destination strings.</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    A new expression, where all the origin paths are promoted and broadcast</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">      until they are children of dest_path_parent.</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">  """</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>  <span class="n">result_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>  <span class="c1"># Here, we branch out and create a different tree for each field that is</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>  <span class="c1"># promoted and broadcast.</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>  <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">origin_path</span> <span class="ow">in</span> <span class="n">path_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">result_path</span> <span class="o">=</span> <span class="n">dest_path_parent</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">new_root</span> <span class="o">=</span> <span class="n">_promote_and_broadcast_name</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">origin_path</span><span class="p">,</span> <span class="n">dest_path_parent</span><span class="p">,</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>                                           <span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">result_paths</span><span class="p">[</span><span class="n">result_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_root</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>  <span class="c1"># We create a new tree that has all of the generated fields from the older</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>  <span class="c1"># trees.</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">result_paths</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast_anonymous" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">promote_and_broadcast_anonymous</span>


<a href="#struct2tensor.expression_impl.promote_and_broadcast.promote_and_broadcast_anonymous" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_and_broadcast_anonymous</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n">new_parent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promotes then broadcasts the origin until its parent is new_parent.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/promote_and_broadcast.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_and_broadcast_anonymous</span><span class="p">(</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">new_parent</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">  </span><span class="sd">"""Promotes then broadcasts the origin until its parent is new_parent."""</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>  <span class="n">least_common_ancestor</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">get_least_common_ancestor</span><span class="p">(</span><span class="n">new_parent</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>  <span class="n">new_expr</span><span class="p">,</span> <span class="n">new_path</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">origin</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>  <span class="k">while</span> <span class="n">new_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span> <span class="o">!=</span> <span class="n">least_common_ancestor</span><span class="p">:</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">new_expr</span><span class="p">,</span> <span class="n">new_path</span> <span class="o">=</span> <span class="n">promote</span><span class="o">.</span><span class="n">promote_anonymous</span><span class="p">(</span><span class="n">new_expr</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>  <span class="k">while</span> <span class="n">new_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span> <span class="o">!=</span> <span class="n">new_parent</span><span class="p">:</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">new_parent_step</span> <span class="o">=</span> <span class="n">new_parent</span><span class="o">.</span><span class="n">field_list</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">new_expr</span><span class="p">,</span> <span class="n">new_path</span> <span class="o">=</span> <span class="n">broadcast</span><span class="o">.</span><span class="n">broadcast_anonymous</span><span class="p">(</span><span class="n">new_expr</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>                                                       <span class="n">new_parent_step</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>  <span class="k">return</span> <span class="n">new_expr</span><span class="p">,</span> <span class="n">new_path</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.promote_and_broadcast-modules">Modules<a href="#struct2tensor.expression_impl.promote_and_broadcast-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.proto" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">proto</span>


<a href="#struct2tensor.expression_impl.proto" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Expressions to parse a proto.</p>
<p>These expressions return values with more information than standard node values.
Specifically, each node calculates additional tensors that are used as inputs
for its children.</p>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_expression_from_file_descriptor_set (struct2tensor.expression_impl.proto.create_expression_from_file_descriptor_set)" href="#struct2tensor.expression_impl.proto.create_expression_from_file_descriptor_set">create_expression_from_file_descriptor_set</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Create an expression from a 1D tensor of serialized protos.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_expression_from_proto (struct2tensor.expression_impl.proto.create_expression_from_proto)" href="#struct2tensor.expression_impl.proto.create_expression_from_proto">create_expression_from_proto</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Create an expression from a 1D tensor of serialized protos.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_transformed_field (struct2tensor.expression_impl.proto.create_transformed_field)" href="#struct2tensor.expression_impl.proto.create_transformed_field">create_transformed_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Create an expression that transforms serialized proto tensors.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            is_proto_expression (struct2tensor.expression_impl.proto.is_proto_expression)" href="#struct2tensor.expression_impl.proto.is_proto_expression">is_proto_expression</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns true if an expression is a ProtoExpression.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            ProtoExpression


  
      module-attribute
   (struct2tensor.expression_impl.proto.ProtoExpression)" href="#struct2tensor.expression_impl.proto.ProtoExpression">ProtoExpression</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            ProtoFieldName


  
      module-attribute
   (struct2tensor.expression_impl.proto.ProtoFieldName)" href="#struct2tensor.expression_impl.proto.ProtoFieldName">ProtoFieldName</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            ProtoFullName


  
      module-attribute
   (struct2tensor.expression_impl.proto.ProtoFullName)" href="#struct2tensor.expression_impl.proto.ProtoFullName">ProtoFullName</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            StrStep


  
      module-attribute
   (struct2tensor.expression_impl.proto.StrStep)" href="#struct2tensor.expression_impl.proto.StrStep">StrStep</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            TransformFn


  
      module-attribute
   (struct2tensor.expression_impl.proto.TransformFn)" href="#struct2tensor.expression_impl.proto.TransformFn">TransformFn</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>



  <div class="doc doc-children">





<h5 id="struct2tensor.expression_impl.proto-attributes">Attributes<a href="#struct2tensor.expression_impl.proto-attributes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.proto.ProtoExpression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">ProtoExpression</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.proto.ProtoExpression" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ProtoExpression</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n"><span title="struct2tensor.expression_impl.proto._ProtoRootExpression">_ProtoRootExpression</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n"><span title="struct2tensor.expression_impl.proto._ProtoChildExpression">_ProtoChildExpression</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n"><span title="struct2tensor.expression_impl.proto._ProtoLeafExpression">_ProtoLeafExpression</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.proto.ProtoFieldName" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">ProtoFieldName</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.proto.ProtoFieldName" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ProtoFieldName</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.proto.ProtoFullName" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">ProtoFullName</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.proto.ProtoFullName" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">ProtoFullName</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.proto.StrStep" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">StrStep</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.proto.StrStep" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">StrStep</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.proto.TransformFn" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">TransformFn</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.proto.TransformFn" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">TransformFn</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="p">[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">,</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">]</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h5 id="struct2tensor.expression_impl.proto-functions">Functions<a href="#struct2tensor.expression_impl.proto-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.proto.create_expression_from_file_descriptor_set" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_expression_from_file_descriptor_set</span>


<a href="#struct2tensor.expression_impl.proto.create_expression_from_file_descriptor_set" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_expression_from_file_descriptor_set</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">tensor_of_protos</span><span class="p">:</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">proto_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            ProtoFullName


  
      module-attribute
   (struct2tensor.expression_impl.proto.ProtoFullName)" href="#struct2tensor.expression_impl.proto.ProtoFullName">ProtoFullName</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">file_descriptor_set</span><span class="p">:</span> <span class="n"><span title="google.protobuf.descriptor_pb2.FileDescriptorSet">FileDescriptorSet</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">message_format</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create an expression from a 1D tensor of serialized protos.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tensor_of_protos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>1D tensor of serialized protos.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.Tensor">Tensor</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>proto_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>fully qualified name (e.g. "some.package.SomeProto") of the
proto in <code>tensor_of_protos</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            ProtoFullName


  
      module-attribute
   (struct2tensor.expression_impl.proto.ProtoFullName)" href="#struct2tensor.expression_impl.proto.ProtoFullName">ProtoFullName</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_descriptor_set</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The FileDescriptorSet proto containing <code>proto_name</code>'s
and all its dependencies' FileDescriptorProto. Note that if file1 imports
file2, then file2's FileDescriptorProto must precede file1's in
file_descriptor_set.file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="google.protobuf.descriptor_pb2.FileDescriptorSet">FileDescriptorSet</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>message_format</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indicates the format of the protocol buffer: is one of
 'text' or 'binary'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>'binary'</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/proto.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_expression_from_file_descriptor_set</span><span class="p">(</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">tensor_of_protos</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">proto_name</span><span class="p">:</span> <span class="n">ProtoFullName</span><span class="p">,</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">file_descriptor_set</span><span class="p">:</span> <span class="n">descriptor_pb2</span><span class="o">.</span><span class="n">FileDescriptorSet</span><span class="p">,</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">message_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">  </span><span class="sd">"""Create an expression from a 1D tensor of serialized protos.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">  Args:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    tensor_of_protos: 1D tensor of serialized protos.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    proto_name: fully qualified name (e.g. "some.package.SomeProto") of the</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">      proto in `tensor_of_protos`.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    file_descriptor_set: The FileDescriptorSet proto containing `proto_name`'s</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">      and all its dependencies' FileDescriptorProto. Note that if file1 imports</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">      file2, then file2's FileDescriptorProto must precede file1's in</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">      file_descriptor_set.file.</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    message_format: Indicates the format of the protocol buffer: is one of</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">       'text' or 'binary'.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    An expression.</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">  """</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>  <span class="n">pool</span> <span class="o">=</span> <span class="n">DescriptorPool</span><span class="p">()</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_descriptor_set</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># This method raises if f's dependencies have not been added.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">pool</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>  <span class="c1"># This method raises if proto not found.</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>  <span class="n">desc</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">FindMessageTypeByName</span><span class="p">(</span><span class="n">proto_name</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>  <span class="k">return</span> <span class="n">create_expression_from_proto</span><span class="p">(</span><span class="n">tensor_of_protos</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">message_format</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.proto.create_expression_from_proto" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_expression_from_proto</span>


<a href="#struct2tensor.expression_impl.proto.create_expression_from_proto" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_expression_from_proto</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">tensor_of_protos</span><span class="p">:</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">desc</span><span class="p">:</span> <span class="n"><span title="google.protobuf.descriptor.Descriptor">Descriptor</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">message_format</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create an expression from a 1D tensor of serialized protos.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tensor_of_protos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>1D tensor of serialized protos.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.Tensor">Tensor</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>desc</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a descriptor of protos in tensor of protos.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="google.protobuf.descriptor.Descriptor">Descriptor</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>message_format</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indicates the format of the protocol buffer: is one of
'text' or 'binary'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>'binary'</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/proto.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_expression_from_proto</span><span class="p">(</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">tensor_of_protos</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">desc</span><span class="p">:</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">,</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">message_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"binary"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">  </span><span class="sd">"""Create an expression from a 1D tensor of serialized protos.</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">  Args:</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    tensor_of_protos: 1D tensor of serialized protos.</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    desc: a descriptor of protos in tensor of protos.</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    message_format: Indicates the format of the protocol buffer: is one of</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">      'text' or 'binary'.</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    An expression.</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">  """</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>  <span class="k">return</span> <span class="n">_ProtoRootExpression</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="n">tensor_of_protos</span><span class="p">,</span> <span class="n">message_format</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.proto.create_transformed_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_transformed_field</span>


<a href="#struct2tensor.expression_impl.proto.create_transformed_field" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_transformed_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.path.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">dest_field</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            StrStep


  
      module-attribute
   (struct2tensor.expression_impl.proto.StrStep)" href="#struct2tensor.expression_impl.proto.StrStep">StrStep</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">transform_fn</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            TransformFn


  
      module-attribute
   (struct2tensor.expression_impl.proto.TransformFn)" href="#struct2tensor.expression_impl.proto.TransformFn">TransformFn</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create an expression that transforms serialized proto tensors.</p>
<p>The transform_fn argument should take the form:</p>
<p>def transform_fn(parent_indices, values):
  ...
  return (transformed_parent_indices, transformed_values)</p>
<p>Given:</p>
<ul>
<li>parent_indices: an int64 vector of non-decreasing parent message indices.</li>
<li>values: a string vector of serialized protos having the same shape as
  <code>parent_indices</code>.</li>
</ul>
<p><code>transform_fn</code> must return new parent indices and serialized values encoding
the same proto message as the passed in <code>values</code>.  These two vectors must
have the same size, but it need not be the same as the input arguments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If CalculateOptions.use_string_view (set at calculate time, thus this
Expression cannot know beforehand) is True, <code>values</code> passed to
<code>transform_fn</code> are string views pointing all the way back to the original
input tensor (of serialized root protos). And <code>transform_fn</code> must maintain
such views and avoid creating new values that are either not string views
into the root protos or self-owned strings. This is because downstream
decoding ops will still produce string views referring into its input
(which are string views into the root proto) and they will only hold a
reference to the original, root proto tensor, keeping it alive. So the input
tensor may get destroyed after the decoding op.</p>
<p>In short, you can do element-wise transforms to <code>values</code>, but can't mutate
the contents of elements in <code>values</code> or create new elements.</p>
<p>To lift this restriction, a decoding op must be told to hold a reference
of the input tensors of all its upstream decoding ops.</p>
</div>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a source expression containing <code>source_path</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path to the field to reverse.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.path.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dest_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the newly created field. This field will be a
sibling of the field identified by <code>source_path</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            StrStep


  
      module-attribute
   (struct2tensor.expression_impl.proto.StrStep)" href="#struct2tensor.expression_impl.proto.StrStep">StrStep</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform_fn</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>a callable that accepts parent_indices and serialized proto
values and returns a posibly modified parent_indices and values. Note that
when CalcuateOptions.use_string_view is set, transform_fn should not have
any stateful side effecting uses of serialized proto inputs. Doing so
could cause segfaults as the backing string tensor lifetime is not
guaranteed when the side effecting operations are run.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            TransformFn


  
      module-attribute
   (struct2tensor.expression_impl.proto.TransformFn)" href="#struct2tensor.expression_impl.proto.TransformFn">TransformFn</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>if the source path is not a proto message field.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/proto.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_transformed_field</span><span class="p">(</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">dest_field</span><span class="p">:</span> <span class="n">StrStep</span><span class="p">,</span> <span class="n">transform_fn</span><span class="p">:</span> <span class="n">TransformFn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">  </span><span class="sd">"""Create an expression that transforms serialized proto tensors.</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">  The transform_fn argument should take the form:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">  def transform_fn(parent_indices, values):</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    ...</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    return (transformed_parent_indices, transformed_values)</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">  Given:</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">  - parent_indices: an int64 vector of non-decreasing parent message indices.</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">  - values: a string vector of serialized protos having the same shape as</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    `parent_indices`.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">  `transform_fn` must return new parent indices and serialized values encoding</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">  the same proto message as the passed in `values`.  These two vectors must</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">  have the same size, but it need not be the same as the input arguments.</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">  !!! Note</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">      If CalculateOptions.use_string_view (set at calculate time, thus this</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">      Expression cannot know beforehand) is True, `values` passed to</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">      `transform_fn` are string views pointing all the way back to the original</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">      input tensor (of serialized root protos). And `transform_fn` must maintain</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">      such views and avoid creating new values that are either not string views</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">      into the root protos or self-owned strings. This is because downstream</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">      decoding ops will still produce string views referring into its input</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">      (which are string views into the root proto) and they will only hold a</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">      reference to the original, root proto tensor, keeping it alive. So the input</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">      tensor may get destroyed after the decoding op.</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">      In short, you can do element-wise transforms to `values`, but can't mutate</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">      the contents of elements in `values` or create new elements.</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">      To lift this restriction, a decoding op must be told to hold a reference</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">      of the input tensors of all its upstream decoding ops.</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">  Args:</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    expr: a source expression containing `source_path`.</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    source_path: the path to the field to reverse.</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    dest_field: the name of the newly created field. This field will be a</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">      sibling of the field identified by `source_path`.</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    transform_fn: a callable that accepts parent_indices and serialized proto</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">      values and returns a posibly modified parent_indices and values. Note that</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">      when CalcuateOptions.use_string_view is set, transform_fn should not have</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">      any stateful side effecting uses of serialized proto inputs. Doing so</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">      could cause segfaults as the backing string tensor lifetime is not</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">      guaranteed when the side effecting operations are run.</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    An expression.</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">  Raises:</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    ValueError: if the source path is not a proto message field.</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">  """</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>  <span class="n">source_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>  <span class="n">source_expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">get_descendant_or_error</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_expr</span><span class="p">,</span> <span class="n">_ProtoChildExpression</span><span class="p">):</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="s2">"Expected _ProtoChildExpression for field </span><span class="si">{}</span><span class="s2">, but found </span><span class="si">{}</span><span class="s2">."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="nb">str</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">source_expr</span><span class="p">))</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_expr</span><span class="p">,</span> <span class="n">_TransformProtoChildExpression</span><span class="p">):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="c1"># In order to be able to propagate fields needed for parsing, the source</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="c1"># expression of _TransformProtoChildExpression must always be the original</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="c1"># _ProtoChildExpression before any transformation. This means that two</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="c1"># sequentially applied _TransformProtoChildExpression would have the same</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="c1"># source and would apply the transformation to the source directly, instead</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="c1"># of one transform operating on the output of the other.</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1"># To work around this, the user supplied transform function is wrapped to</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="c1"># first call the source's transform function.</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="c1"># The downside of this approach is that the initial transform may be</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="c1"># applied redundantly if there are other expressions derived directly</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="c1"># from it.</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">final_transform</span><span class="p">(</span><span class="n">parent_indices</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>                        <span class="n">values</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>      <span class="n">parent_indices</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">source_expr</span><span class="o">.</span><span class="n">transform_fn</span><span class="p">(</span><span class="n">parent_indices</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>      <span class="k">return</span> <span class="n">transform_fn</span><span class="p">(</span><span class="n">parent_indices</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="n">final_transform</span> <span class="o">=</span> <span class="n">transform_fn</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>  <span class="n">transformed_expr</span> <span class="o">=</span> <span class="n">_TransformProtoChildExpression</span><span class="p">(</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>      <span class="n">parent</span><span class="o">=</span><span class="n">source_expr</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>      <span class="n">desc</span><span class="o">=</span><span class="n">source_expr</span><span class="o">.</span><span class="n">_desc</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>      <span class="n">is_repeated</span><span class="o">=</span><span class="n">source_expr</span><span class="o">.</span><span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>      <span class="n">name_as_field</span><span class="o">=</span><span class="n">source_expr</span><span class="o">.</span><span class="n">name_as_field</span><span class="p">,</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>      <span class="n">transform_fn</span><span class="o">=</span><span class="n">final_transform</span><span class="p">,</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>      <span class="n">backing_str_tensor</span><span class="o">=</span><span class="n">source_expr</span><span class="o">.</span><span class="n">_backing_str_tensor</span><span class="p">)</span>  <span class="c1"># pylint: disable=protected-access</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>  <span class="n">dest_path</span> <span class="o">=</span> <span class="n">source_path</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">dest_field</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">{</span><span class="n">dest_path</span><span class="p">:</span> <span class="n">transformed_expr</span><span class="p">})</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.proto.is_proto_expression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">is_proto_expression</span>


<a href="#struct2tensor.expression_impl.proto.is_proto_expression" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">is_proto_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns true if an expression is a ProtoExpression.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/proto.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_proto_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">  </span><span class="sd">"""Returns true if an expression is a ProtoExpression."""</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>      <span class="n">expr</span><span class="p">,</span> <span class="p">(</span><span class="n">_ProtoRootExpression</span><span class="p">,</span> <span class="n">_ProtoChildExpression</span><span class="p">,</span> <span class="n">_ProtoLeafExpression</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.proto-modules">Modules<a href="#struct2tensor.expression_impl.proto-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.reroot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">reroot</span>


<a href="#struct2tensor.expression_impl.reroot" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Reroot to a subtree, maintaining an input proto index.</p>
<p>reroot is similar to get_descendant_or_error. However, this method allows
you to call create_proto_index(...) later on, that gives you a reference to the
original proto.</p>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_proto_index_field (struct2tensor.expression_impl.reroot.create_proto_index_field)" href="#struct2tensor.expression_impl.reroot.create_proto_index_field">create_proto_index_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            reroot (struct2tensor.expression_impl.reroot.reroot)" href="#struct2tensor.expression_impl.reroot.reroot">reroot</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Reroot to a new path, maintaining a input proto index.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">







<h5 id="struct2tensor.expression_impl.reroot-functions">Functions<a href="#struct2tensor.expression_impl.reroot-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.reroot.create_proto_index_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">create_proto_index_field</span>


<a href="#struct2tensor.expression_impl.reroot.create_proto_index_field" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_proto_index_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/reroot.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_proto_index_field</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                             <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_paths</span><span class="p">(</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>      <span class="n">root</span><span class="p">,</span> <span class="p">{</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">new_field_name</span><span class="p">]):</span> <span class="n">_InputProtoIndexExpression</span><span class="p">(</span><span class="n">root</span><span class="p">)})</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.reroot.reroot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">reroot</span>


<a href="#struct2tensor.expression_impl.reroot.reroot" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reroot</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Reroot to a new path, maintaining a input proto index.</p>
<p>Similar to root.get_descendant_or_error(source_path): however, this
method retains the ability to get a map to the original index.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path to the new root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the new root.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/reroot.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">reroot</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>           <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">  </span><span class="sd">"""Reroot to a new path, maintaining a input proto index.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">  Similar to root.get_descendant_or_error(source_path): however, this</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">  method retains the ability to get a map to the original index.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">  Args:</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    root: the original root.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    source_path: the path to the new root.</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    the new root.</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">  """</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>  <span class="n">new_root</span> <span class="o">=</span> <span class="n">root</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>  <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">source_path</span><span class="o">.</span><span class="n">field_list</span><span class="p">:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">new_root</span> <span class="o">=</span> <span class="n">_RerootExpression</span><span class="p">(</span><span class="n">new_root</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>  <span class="k">return</span> <span class="n">new_root</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.reroot-modules">Modules<a href="#struct2tensor.expression_impl.reroot-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.size" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">size</span>


<a href="#struct2tensor.expression_impl.size" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Functions for creating new size or has expression.</p>
<p>Given a field "foo.bar",</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">root</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span><span class="s2">"bar"</span><span class="p">]),</span> <span class="s2">"bar_size"</span><span class="p">)</span>
</span></code></pre></div>
<p>creates a new expression root that has an optional field "foo.bar_size", which
is always present, and contains the number of bar in a particular foo.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">root_2</span> <span class="o">=</span> <span class="n">has</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span><span class="s2">"bar"</span><span class="p">]),</span> <span class="s2">"bar_has"</span><span class="p">)</span>
</span></code></pre></div>
<p>creates a new expression root that has an optional field "foo.bar_has", which
is always present, and is true if there are one or more bar in foo.</p>








<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">CLASS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            SizeExpression (struct2tensor.expression_impl.size.SizeExpression)" href="#struct2tensor.expression_impl.size.SizeExpression">SizeExpression</a></code></td>
            <td class="doc-class-details">
              <div class="doc-md-description">
                <p>Size of the given expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            has (struct2tensor.expression_impl.size.has)" href="#struct2tensor.expression_impl.size.has">has</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get the has of a field as a new sibling field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            size (struct2tensor.expression_impl.size.size)" href="#struct2tensor.expression_impl.size.size">size</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get the size of a field as a new sibling field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            size_anonymous (struct2tensor.expression_impl.size.size_anonymous)" href="#struct2tensor.expression_impl.size.size_anonymous">size_anonymous</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculate the size of a field, and store it as an anonymous sibling.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">






<h5 id="struct2tensor.expression_impl.size-classes">Classes<a href="#struct2tensor.expression_impl.size-classes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-class">



<h6 id="struct2tensor.expression_impl.size.SizeExpression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">SizeExpression</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">SizeExpression</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">origin_parent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="struct2tensor.expression.Leaf">Leaf</span></code></p>


        <p>Size of the given expression.</p>
<p>SizeExpression is intended to be a sibling of origin.
origin_parent should be the parent of origin.</p>

        <p>Initialize a Leaf.</p>
<p>Note that a leaf must have a specified type.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if the expression is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>my_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the DType of the field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema_feature</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>schema information about the field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply (struct2tensor.expression_impl.size.SizeExpression.apply)" href="#struct2tensor.expression_impl.size.SizeExpression.apply">apply</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            apply_schema (struct2tensor.expression_impl.size.SizeExpression.apply_schema)" href="#struct2tensor.expression_impl.size.SizeExpression.apply_schema">apply_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            broadcast (struct2tensor.expression_impl.size.SizeExpression.broadcast)" href="#struct2tensor.expression_impl.size.SizeExpression.broadcast">broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Broadcasts the existing field at source_path to the sibling_field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculate (struct2tensor.expression_impl.size.SizeExpression.calculate)" href="#struct2tensor.expression_impl.size.SizeExpression.calculate">calculate</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculates the node tensor of the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculation_equal (struct2tensor.expression_impl.size.SizeExpression.calculation_equal)" href="#struct2tensor.expression_impl.size.SizeExpression.calculation_equal">calculation_equal</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>self.calculate is equal to another expression.calculate.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            calculation_is_identity (struct2tensor.expression_impl.size.SizeExpression.calculation_is_identity)" href="#struct2tensor.expression_impl.size.SizeExpression.calculation_is_identity">calculation_is_identity</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>True iff the self.calculate is the identity.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            cogroup_by_index (struct2tensor.expression_impl.size.SizeExpression.cogroup_by_index)" href="#struct2tensor.expression_impl.size.SizeExpression.cogroup_by_index">cogroup_by_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a cogroup of left_name and right_name at new_field_name.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_has_field (struct2tensor.expression_impl.size.SizeExpression.create_has_field)" href="#struct2tensor.expression_impl.size.SizeExpression.create_has_field">create_has_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a field that is the presence of the source path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_proto_index (struct2tensor.expression_impl.size.SizeExpression.create_proto_index)" href="#struct2tensor.expression_impl.size.SizeExpression.create_proto_index">create_proto_index</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a proto index field as a direct child of the current root.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            create_size_field (struct2tensor.expression_impl.size.SizeExpression.create_size_field)" href="#struct2tensor.expression_impl.size.SizeExpression.create_size_field">create_size_field</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a field that is the size of the source path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child (struct2tensor.expression_impl.size.SizeExpression.get_child)" href="#struct2tensor.expression_impl.size.SizeExpression.get_child">get_child</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a named child.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_child_or_error (struct2tensor.expression_impl.size.SizeExpression.get_child_or_error)" href="#struct2tensor.expression_impl.size.SizeExpression.get_child_or_error">get_child_or_error</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a named child.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_descendant (struct2tensor.expression_impl.size.SizeExpression.get_descendant)" href="#struct2tensor.expression_impl.size.SizeExpression.get_descendant">get_descendant</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Finds the descendant at the path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_descendant_or_error (struct2tensor.expression_impl.size.SizeExpression.get_descendant_or_error)" href="#struct2tensor.expression_impl.size.SizeExpression.get_descendant_or_error">get_descendant_or_error</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Finds the descendant at the path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_known_children (struct2tensor.expression_impl.size.SizeExpression.get_known_children)" href="#struct2tensor.expression_impl.size.SizeExpression.get_known_children">get_known_children</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_known_descendants (struct2tensor.expression_impl.size.SizeExpression.get_known_descendants)" href="#struct2tensor.expression_impl.size.SizeExpression.get_known_descendants">get_known_descendants</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets a mapping from known paths to subexpressions.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_paths_with_schema (struct2tensor.expression_impl.size.SizeExpression.get_paths_with_schema)" href="#struct2tensor.expression_impl.size.SizeExpression.get_paths_with_schema">get_paths_with_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Extract only paths that contain schema information.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_schema (struct2tensor.expression_impl.size.SizeExpression.get_schema)" href="#struct2tensor.expression_impl.size.SizeExpression.get_schema">get_schema</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a schema for the entire tree.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            get_source_expressions (struct2tensor.expression_impl.size.SizeExpression.get_source_expressions)" href="#struct2tensor.expression_impl.size.SizeExpression.get_source_expressions">get_source_expressions</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Gets the sources of this expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            known_field_names (struct2tensor.expression_impl.size.SizeExpression.known_field_names)" href="#struct2tensor.expression_impl.size.SizeExpression.known_field_names">known_field_names</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns known field names of the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_field_values (struct2tensor.expression_impl.size.SizeExpression.map_field_values)" href="#struct2tensor.expression_impl.size.SizeExpression.map_field_values">map_field_values</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map a primitive field to create a new primitive field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_ragged_tensors (struct2tensor.expression_impl.size.SizeExpression.map_ragged_tensors)" href="#struct2tensor.expression_impl.size.SizeExpression.map_ragged_tensors">map_ragged_tensors</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a set of primitive fields of a message to a new field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            map_sparse_tensors (struct2tensor.expression_impl.size.SizeExpression.map_sparse_tensors)" href="#struct2tensor.expression_impl.size.SizeExpression.map_sparse_tensors">map_sparse_tensors</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Maps a set of primitive fields of a message to a new field.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            project (struct2tensor.expression_impl.size.SizeExpression.project)" href="#struct2tensor.expression_impl.size.SizeExpression.project">project</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Constrains the paths to those listed.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote (struct2tensor.expression_impl.size.SizeExpression.promote)" href="#struct2tensor.expression_impl.size.SizeExpression.promote">promote</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Promotes source_path to be a field new_field_name in its grandparent.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            promote_and_broadcast (struct2tensor.expression_impl.size.SizeExpression.promote_and_broadcast)" href="#struct2tensor.expression_impl.size.SizeExpression.promote_and_broadcast">promote_and_broadcast</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            reroot (struct2tensor.expression_impl.size.SizeExpression.reroot)" href="#struct2tensor.expression_impl.size.SizeExpression.reroot">reroot</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a new list of protocol buffers available at new_root.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            schema_string (struct2tensor.expression_impl.size.SizeExpression.schema_string)" href="#struct2tensor.expression_impl.size.SizeExpression.schema_string">schema_string</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Returns a schema for the expression.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            slice (struct2tensor.expression_impl.size.SizeExpression.slice)" href="#struct2tensor.expression_impl.size.SizeExpression.slice">slice</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a slice copy of source_path at new_field_path.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            truncate (struct2tensor.expression_impl.size.SizeExpression.truncate)" href="#struct2tensor.expression_impl.size.SizeExpression.truncate">truncate</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a truncated copy of source_path at new_field_path.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_leaf


  
      property
   (struct2tensor.expression_impl.size.SizeExpression.is_leaf)" href="#struct2tensor.expression_impl.size.SizeExpression.is_leaf">is_leaf</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>True iff the node tensor is a LeafNodeTensor.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            is_repeated


  
      property
   (struct2tensor.expression_impl.size.SizeExpression.is_repeated)" href="#struct2tensor.expression_impl.size.SizeExpression.is_repeated">is_repeated</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>True iff the same parent value can have multiple children values.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            schema_feature


  
      property
   (struct2tensor.expression_impl.size.SizeExpression.schema_feature)" href="#struct2tensor.expression_impl.size.SizeExpression.schema_feature">schema_feature</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>Return the schema of the field.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            type


  
      property
   (struct2tensor.expression_impl.size.SizeExpression.type)" href="#struct2tensor.expression_impl.size.SizeExpression.type">type</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                <p>dtype of the expression, or None if not a leaf expression.</p>
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="tensorflow.DType">DType</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            validate_step_format


  
      property
   (struct2tensor.expression_impl.size.SizeExpression.validate_step_format)" href="#struct2tensor.expression_impl.size.SizeExpression.validate_step_format">validate_step_format</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-attribute-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

                  <details class="quote">
                    <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
                    <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>             <span class="n">origin_parent</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>  <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">origin</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span> <span class="o">=</span> <span class="n">origin_parent</span>
</span></code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">





<h7 id="struct2tensor.expression_impl.size.SizeExpression-attributes">Attributes<a href="#struct2tensor.expression_impl.size.SizeExpression-attributes" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.size.SizeExpression.is_leaf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_leaf</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.size.SizeExpression.is_leaf" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_leaf</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the node tensor is a LeafNodeTensor.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.size.SizeExpression.is_repeated" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">is_repeated</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.size.SizeExpression.is_repeated" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the same parent value can have multiple children values.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.size.SizeExpression.schema_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">schema_feature</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.size.SizeExpression.schema_feature" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">schema_feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Feature">Feature</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the schema of the field.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.size.SizeExpression.type" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">type</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.size.SizeExpression.type" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">type</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>dtype of the expression, or None if not a leaf expression.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h8 id="struct2tensor.expression_impl.size.SizeExpression.validate_step_format" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">validate_step_format</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#struct2tensor.expression_impl.size.SizeExpression.validate_step_format" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">validate_step_format</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h7 id="struct2tensor.expression_impl.size.SizeExpression-functions">Functions<a href="#struct2tensor.expression_impl.size.SizeExpression-functions" class="headerlink" title="Permanent link">¶</a></h7>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.apply" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">apply</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.apply" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">transform</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>          <span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="s2">"Expression"</span><span class="p">],</span> <span class="s2">"Expression"</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>  <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.apply_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">apply_schema</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.apply_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">apply_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="k">def</span><span class="w"> </span><span class="nf">apply_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>  <span class="k">return</span> <span class="n">apply_schema</span><span class="o">.</span><span class="n">apply_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">broadcast</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.broadcast" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">sibling_field</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Broadcasts the existing field at source_path to the sibling_field.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="k">def</span><span class="w"> </span><span class="nf">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">sibling_field</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>              <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="w">  </span><span class="sd">"""Broadcasts the existing field at source_path to the sibling_field."""</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>  <span class="k">return</span> <span class="n">broadcast</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>                             <span class="n">sibling_field</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.calculate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculate</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.calculate" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">sources</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">destinations</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">options</span><span class="p">:</span> <span class="n"><span title="struct2tensor.calculate_options.Options">Options</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">side_info</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculates the node tensor of the expression.</p>
<p>The node tensor must be a function of the properties of the expression
and the node tensors of the expressions from get_source_expressions().</p>
<p>If is_leaf, then calculate must return a LeafNodeTensor.
Otherwise, it must return a ChildNodeTensor or RootNodeTensor.</p>
<p>If calculate_is_identity is true, then this must return source_tensors[0].</p>
<p>Sometimes, for operations such as parsing the proto, calculate will return
additional information. For example, calculate() for the root of the
proto expression also parses out the tensors required to calculate the
tensors of the children. This is why destinations are required.</p>
<p>For a reference use, see calculate_value_slowly(...) below.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_tensors</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The node tensors of the expressions in
get_source_expressions().</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destinations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expressions that will use the output of this method.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Options for the calculation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.calculate_options.Options">Options</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>side_info</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>An optional prensor that is used to bind to a placeholder
expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="            Prensor (struct2tensor.prensor.Prensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Prensor">Prensor</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            NodeTensor


  
      module-attribute
   (struct2tensor.prensor.NodeTensor)" href="../../s2t/s2t/#struct2tensor.struct2tensor.NodeTensor">NodeTensor</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A NodeTensor representing the output of this expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">sources</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">prensor</span><span class="o">.</span><span class="n">NodeTensor</span><span class="p">],</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">destinations</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">],</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">options</span><span class="p">:</span> <span class="n">calculate_options</span><span class="o">.</span><span class="n">Options</span><span class="p">,</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">side_info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prensor</span><span class="o">.</span><span class="n">Prensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">prensor</span><span class="o">.</span><span class="n">NodeTensor</span><span class="p">:</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>  <span class="p">[</span><span class="n">origin_value</span><span class="p">,</span> <span class="n">origin_parent_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin_value</span><span class="p">,</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>                    <span class="p">(</span><span class="n">prensor</span><span class="o">.</span><span class="n">LeafNodeTensor</span><span class="p">,</span> <span class="n">prensor</span><span class="o">.</span><span class="n">ChildNodeTensor</span><span class="p">)):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="s2">"origin_value must be a LeafNodeTensor or a ChildNodeTensor, "</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="s2">"but was a "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">origin_value</span><span class="p">)))</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin_parent_value</span><span class="p">,</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>                    <span class="p">(</span><span class="n">prensor</span><span class="o">.</span><span class="n">ChildNodeTensor</span><span class="p">,</span> <span class="n">prensor</span><span class="o">.</span><span class="n">RootNodeTensor</span><span class="p">)):</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"origin_parent_value must be a ChildNodeTensor "</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>                     <span class="s2">"or a RootNodeTensor, but was a "</span> <span class="o">+</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>                     <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">origin_parent_value</span><span class="p">)))</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>  <span class="n">parent_index</span> <span class="o">=</span> <span class="n">origin_value</span><span class="o">.</span><span class="n">parent_index</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>  <span class="n">num_parent_protos</span> <span class="o">=</span> <span class="n">origin_parent_value</span><span class="o">.</span><span class="n">size</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>  <span class="c1"># A vector of 1s of the same size as the parent_index.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>  <span class="n">updates</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">parent_index</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>  <span class="n">indices</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">parent_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>  <span class="c1"># This is incrementing the size by 1 for each element.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>  <span class="c1"># Obviously, not the fastest way to do this.</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>  <span class="n">values</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">scatter_nd</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">updates</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_parent_protos</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>  <span class="c1"># Need to create a new_parent_index = 0,1,2,3,4...n.</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>  <span class="n">new_parent_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">num_parent_protos</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>  <span class="k">return</span> <span class="n">prensor</span><span class="o">.</span><span class="n">LeafNodeTensor</span><span class="p">(</span><span class="n">new_parent_index</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.calculation_equal" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculation_equal</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.calculation_equal" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculation_equal</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>self.calculate is equal to another expression.calculate.</p>
<p>Given the same source node tensors, self.calculate(...) and
expression.calculate(...) will have the same result.</p>
<p>Note that this does not check that the source expressions of the two
expressions are the same. Therefore, two operations can have the same
calculation, but not the same output, because their sources are different.
For example, if a.calculation_is_identity() is True and
b.calculation_is_identity() is True, then a.calculation_equal(b) is True.
However, unless a and b have the same source, the expressions themselves are
not equal.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expression</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The expression to compare to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculation_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">SizeExpression</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.calculation_is_identity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">calculation_is_identity</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.calculation_is_identity" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculation_is_identity</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>True iff the self.calculate is the identity.</p>
<p>There is exactly one source, and the output of self.calculate(...) is the
node tensor of this source.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculation_is_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>  <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.cogroup_by_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">cogroup_by_index</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.cogroup_by_index" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">cogroup_by_index</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">left_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">right_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a cogroup of left_name and right_name at new_field_name.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="k">def</span><span class="w"> </span><span class="nf">cogroup_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">left_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>                     <span class="n">right_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="w">  </span><span class="sd">"""Creates a cogroup of left_name and right_name at new_field_name."""</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>  <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"cogroup_by_index is not implemented"</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.create_has_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_has_field</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.create_has_field" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_has_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a field that is the presence of the source path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_has_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="w">  </span><span class="sd">"""Creates a field that is the presence of the source path."""</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>  <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.create_proto_index" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_proto_index</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.create_proto_index" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_proto_index</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a proto index field as a direct child of the current root.</p>
<p>The proto index maps each root element to the original batch index.
For example: [0, 2] means the first element came from the first proto
in the original input tensor and the second element came from the third
proto. The created field is always "dense" -- it has the same valency as
the current root.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the field to be created.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An Expression object representing the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_proto_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="w">  </span><span class="sd">"""Creates a proto index field as a direct child of the current root.</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">  The proto index maps each root element to the original batch index.</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">  For example: [0, 2] means the first element came from the first proto</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">  in the original input tensor and the second element came from the third</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">  proto. The created field is always "dense" -- it has the same valency as</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">  the current root.</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">  Args:</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    field_name: the name of the field to be created.</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    An Expression object representing the result of the operation.</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">  """</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>  <span class="k">return</span> <span class="n">reroot</span><span class="o">.</span><span class="n">create_proto_index_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.create_size_field" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_size_field</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.create_size_field" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_size_field</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a field that is the size of the source path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_size_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>                      <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="w">  </span><span class="sd">"""Creates a field that is the size of the source path."""</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>  <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_child" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_child" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a named child.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="w">  </span><span class="sd">"""Gets a named child."""</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>  <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">:</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_child_impl</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_child_cache</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_child_or_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_child_or_error</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_child_or_error" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_child_or_error</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a named child.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_child_or_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="w">  </span><span class="sd">"""Gets a named child."""</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"No such field: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_name</span><span class="p">))</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_descendant" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_descendant</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_descendant" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the descendant at the path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="w">  </span><span class="sd">"""Finds the descendant at the path."""</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>  <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">field_list</span><span class="p">:</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>      <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_descendant_or_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_descendant_or_error</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_descendant_or_error" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_descendant_or_error</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Finds the descendant at the path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_descendant_or_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">  </span><span class="sd">"""Finds the descendant at the path."""</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>  <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descendant</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>  <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Missing path: </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_string</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)))</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_known_children" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_known_children</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_known_children" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_known_children</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_known_children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>  <span class="n">known_field_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">known_field_names</span><span class="p">()</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>  <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">known_field_names</span><span class="p">:</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_child_or_error</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_known_descendants" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_known_descendants</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_known_descendants" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_known_descendants</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets a mapping from known paths to subexpressions.</p>
<p>The difference between this and get_descendants in Prensor is that
all paths in a Prensor are realized, thus all known. But an Expression's
descendants might not all be known at the point this method is called,
because an expression may have an infinite number of children.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a>[<a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>, <a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A mapping from paths (relative to the root of the subexpression) to
expressions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_known_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="s2">"Expression"</span><span class="p">]:</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a>  <span class="c1"># Rename get_known_descendants</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="w">  </span><span class="sd">"""Gets a mapping from known paths to subexpressions.</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">  The difference between this and get_descendants in Prensor is that</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">  all paths in a Prensor are realized, thus all known. But an Expression's</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">  descendants might not all be known at the point this method is called,</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">  because an expression may have an infinite number of children.</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    A mapping from paths (relative to the root of the subexpression) to</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">      expressions.</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">  """</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>  <span class="n">known_subexpressions</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>      <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get_known_descendants</span><span class="p">()</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_known_children</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>  <span class="p">}</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>  <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">subexpression</span> <span class="ow">in</span> <span class="n">known_subexpressions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">subexpression_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="p">[</span><span class="n">field_name</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="p">)</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">subexpression</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>      <span class="n">result</span><span class="p">[</span><span class="n">subexpression_path</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="o">=</span> <span class="n">expr</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>  <span class="n">result</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_paths_with_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_paths_with_schema</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_paths_with_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_paths_with_schema</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Extract only paths that contain schema information.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_paths_with_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="w">  </span><span class="sd">"""Extract only paths that contain schema information."""</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>  <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a>  <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_known_children</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">schema_feature</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>      <span class="k">continue</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="p">[</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="p">)</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">get_paths_with_schema</span><span class="p">()</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="p">]</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="p">)</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a>  <span class="c1"># Note: We always take the root path and so will return an empty schema</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a>  <span class="c1"># if there is no schema information on any nodes, including the root.</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="p">)</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_schema" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_schema</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_schema" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_schema</span><span class="p">(</span><span class="n">create_schema_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="tensorflow_metadata.proto.v0.schema_pb2.Schema">Schema</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a schema for the entire tree.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>create_schema_features</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, schema features are added for all
children and a schema entry is created if not available on the child. If
False, features are left off of the returned schema if there is no
schema_feature on the child.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">create_schema_features</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">:</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="w">  </span><span class="sd">"""Returns a schema for the entire tree.</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">  Args:</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    create_schema_features: If True, schema features are added for all</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">      children and a schema entry is created if not available on the child. If</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">      False, features are left off of the returned schema if there is no</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">      schema_feature on the child.</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">  """</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">create_schema_features</span><span class="p">:</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_paths_with_schema</span><span class="p">())</span><span class="o">.</span><span class="n">get_schema</span><span class="p">()</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">schema_pb2</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>  <span class="bp">self</span><span class="o">.</span><span class="n">_populate_schema_feature_children</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>  <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.get_source_expressions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_source_expressions</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.get_source_expressions" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_source_expressions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the sources of this expression.</p>
<p>The node tensors of the source expressions must be sufficient to
calculate the node tensor of this expression
(see calculate and calculate_value_slowly).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The sources of this expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_source_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">]:</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>  <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_origin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin_parent</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.known_field_names" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">known_field_names</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.known_field_names" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">known_field_names</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns known field names of the expression.</p>
<p>TODO(martinz): implement set_field and project.
Known field names of a parsed proto correspond to the fields declared in
the message. Examples of "unknown" fields are extensions and explicit casts
in an any field. The only way to know if an unknown field "(foo.bar)" is
present in an expression expr is to call (expr["(foo.bar)"] is not None).</p>
<p>Notice that simply accessing a field does not make it "known". However,
setting a field (or setting a descendant of a field) will make it known.</p>
<p>project(...) returns an expression where the known field names are the only
field names. In general, if you want to depend upon known_field_names
(e.g., if you want to compile a expression), then the best approach is to
project() the expression first.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.FrozenSet" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet">FrozenSet</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An immutable set of field names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="k">def</span><span class="w"> </span><span class="nf">known_field_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrozenSet</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">]:</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a>  <span class="k">return</span> <span class="nb">frozenset</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.map_field_values" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_field_values</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.map_field_values" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_field_values</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[[</span><span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Map a primitive field to create a new primitive field.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The dtype argument is added since the v1 API.</p>
</div>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the origin path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an element-wise operator that takes a 1-dimensional vector.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[[<span title="tensorflow.Tensor">Tensor</span>], <span title="tensorflow.Tensor">Tensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the type of the output.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of a new sibling of source_path.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the resulting root expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_field_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a>                     <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>                     <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="w">  </span><span class="sd">"""Map a primitive field to create a new primitive field.</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">  !!! Note</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">      The dtype argument is added since the v1 API.</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">  Args:</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    source_path: the origin path.</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    operator: an element-wise operator that takes a 1-dimensional vector.</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    dtype: the type of the output.</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    new_field_name: the name of a new sibling of source_path.</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">    the resulting root expression.</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">  """</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>  <span class="k">return</span> <span class="n">map_values</span><span class="o">.</span><span class="n">map_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>                               <span class="n">dtype</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.map_ragged_tensors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_ragged_tensors</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.map_ragged_tensors" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_ragged_tensors</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a set of primitive fields of a message to a new field.</p>
<p>Unlike map_field_values, this operation allows you to some degree reshape
the field. For instance, you can take two optional fields and create a
repeated field, or perform a reduce_sum on the last dimension of a repeated
field and create an optional field. The key constraint is that the operator
must return a sparse tensor of the correct dimension: i.e., a
2D sparse tensor if is_repeated is true, or a 1D sparse tensor if
is_repeated is false. Moreover, the first dimension of the sparse tensor
must be equal to the first dimension of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parent of the input and output fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the nonempty list of names of the source fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an operator that takes len(source_fields) sparse tensors and
returns a sparse tensor of the appropriate shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the output is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of the result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the resulting field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_ragged_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a>                       <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>                       <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>                       <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="w">  </span><span class="sd">"""Maps a set of primitive fields of a message to a new field.</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">  Unlike map_field_values, this operation allows you to some degree reshape</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">  the field. For instance, you can take two optional fields and create a</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">  repeated field, or perform a reduce_sum on the last dimension of a repeated</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">  field and create an optional field. The key constraint is that the operator</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">  must return a sparse tensor of the correct dimension: i.e., a</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">  2D sparse tensor if is_repeated is true, or a 1D sparse tensor if</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">  is_repeated is false. Moreover, the first dimension of the sparse tensor</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">  must be equal to the first dimension of the input tensor.</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">  Args:</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    parent_path: the parent of the input and output fields.</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    source_fields: the nonempty list of names of the source fields.</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">    operator: an operator that takes len(source_fields) sparse tensors and</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">      returns a sparse tensor of the appropriate shape.</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">    is_repeated: whether the output is repeated.</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    dtype: the dtype of the result.</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    new_field_name: the name of the resulting field.</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">    A new query.</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">  """</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>  <span class="k">return</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_ragged_tensor</span><span class="p">(</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>      <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">),</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>      <span class="p">[</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>          <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>      <span class="p">],</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>      <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>      <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>      <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a>      <span class="n">new_field_name</span><span class="p">,</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a>  <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.map_sparse_tensors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">map_sparse_tensors</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.map_sparse_tensors" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">map_sparse_tensors</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">parent_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_fields</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">operator</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><span title="tensorflow.SparseTensor">SparseTensor</span></span><span class="p">],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">is_repeated</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n"><span title="tensorflow.DType">DType</span></span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Maps a set of primitive fields of a message to a new field.</p>
<p>Unlike map_field_values, this operation allows you to some degree reshape
the field. For instance, you can take two optional fields and create a
repeated field, or perform a reduce_sum on the last dimension of a repeated
field and create an optional field. The key constraint is that the operator
must return a sparse tensor of the correct dimension: i.e., a
2D sparse tensor if is_repeated is true, or a 1D sparse tensor if
is_repeated is false. Moreover, the first dimension of the sparse tensor
must be equal to the first dimension of the input tensor.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parent_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the parent of the input and output fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_fields</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the nonempty list of names of the source fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>an operator that takes len(source_fields) sparse tensors and
returns a sparse tensor of the appropriate shape.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>[..., <span title="tensorflow.SparseTensor">SparseTensor</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_repeated</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>whether the output is repeated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the dtype of the result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="tensorflow.DType">DType</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the resulting field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new query.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="k">def</span><span class="w"> </span><span class="nf">map_sparse_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>                       <span class="n">source_fields</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">],</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>                       <span class="n">operator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">],</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>                       <span class="n">is_repeated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">DType</span><span class="p">,</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>                       <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="w">  </span><span class="sd">"""Maps a set of primitive fields of a message to a new field.</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">  Unlike map_field_values, this operation allows you to some degree reshape</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">  the field. For instance, you can take two optional fields and create a</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">  repeated field, or perform a reduce_sum on the last dimension of a repeated</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">  field and create an optional field. The key constraint is that the operator</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">  must return a sparse tensor of the correct dimension: i.e., a</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">  2D sparse tensor if is_repeated is true, or a 1D sparse tensor if</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">  is_repeated is false. Moreover, the first dimension of the sparse tensor</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">  must be equal to the first dimension of the input tensor.</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">  Args:</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    parent_path: the parent of the input and output fields.</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    source_fields: the nonempty list of names of the source fields.</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    operator: an operator that takes len(source_fields) sparse tensors and</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">      returns a sparse tensor of the appropriate shape.</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    is_repeated: whether the output is repeated.</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    dtype: the dtype of the result.</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">    new_field_name: the name of the resulting field.</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">    A new query.</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">  """</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a>  <span class="k">return</span> <span class="n">map_prensor</span><span class="o">.</span><span class="n">map_sparse_tensor</span><span class="p">(</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>      <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">),</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>      <span class="p">[</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>          <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="n">validate_step_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validate_step_format</span><span class="p">)</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a>          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">source_fields</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>      <span class="p">],</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a>      <span class="n">operator</span><span class="p">,</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a>      <span class="n">is_repeated</span><span class="p">,</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>      <span class="n">dtype</span><span class="p">,</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a>      <span class="n">new_field_name</span><span class="p">,</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a>  <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.project" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">project</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.project" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">project</span><span class="p">(</span><span class="n">path_list</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Sequence" href="https://docs.python.org/3/library/typing.html#typing.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Constrains the paths to those listed.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="k">def</span><span class="w"> </span><span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_list</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">CoercableToPath</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="w">  </span><span class="sd">"""Constrains the paths to those listed."""</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>  <span class="k">return</span> <span class="n">project</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">])</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.promote" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.promote" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote</span><span class="p">(</span><span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Promotes source_path to be a field new_field_name in its grandparent.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">):</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="w">  </span><span class="sd">"""Promotes source_path to be a field new_field_name in its grandparent."""</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>  <span class="k">return</span> <span class="n">promote</span><span class="o">.</span><span class="n">promote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.promote_and_broadcast" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">promote_and_broadcast</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.promote_and_broadcast" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">path_dictionary</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Mapping" href="https://docs.python.org/3/library/typing.html#typing.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="k">def</span><span class="w"> </span><span class="nf">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">path_dictionary</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">CoercableToPath</span><span class="p">],</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">dest_path_parent</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>  <span class="k">return</span> <span class="n">promote_and_broadcast</span><span class="o">.</span><span class="n">promote_and_broadcast</span><span class="p">(</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>      <span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">path_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a>      <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">dest_path_parent</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.reroot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">reroot</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.reroot" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reroot</span><span class="p">(</span><span class="n">new_root</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a new list of protocol buffers available at new_root.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="k">def</span><span class="w"> </span><span class="nf">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_root</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="w">  </span><span class="sd">"""Returns a new list of protocol buffers available at new_root."""</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>  <span class="k">return</span> <span class="n">reroot</span><span class="o">.</span><span class="n">reroot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">new_root</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.schema_string" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">schema_string</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.schema_string" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">schema_string</span><span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns a schema for the expression.</p>
<p>For examle,
</p><div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>repeated root:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  optional int32 foo
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  optional bar:
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    optional string baz
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  optional int64 bak
</span></code></pre></div>
<p>Note that unknown fields and subexpressions are not displayed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>if present, limit the recursion.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A string, describing (a part of) the schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="k">def</span><span class="w"> </span><span class="nf">schema_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="w">  </span><span class="sd">"""Returns a schema for the expression.</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">  For examle,</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">  ```</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">  repeated root:</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">    optional int32 foo</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    optional bar:</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">      optional string baz</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    optional int64 bak</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">  ```</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">  Note that unknown fields and subexpressions are not displayed.</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">  Args:</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">    limit: if present, limit the recursion.</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    A string, describing (a part of) the schema.</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">  """</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>  <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schema_string_helper</span><span class="p">(</span><span class="s2">"root"</span><span class="p">,</span> <span class="n">limit</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.slice" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">slice</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.slice" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">slice</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">begin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">end</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a slice copy of source_path at new_field_path.</p>
<p>Note that if begin or end is negative, it is considered relative to
the size of the array. e.g., slice(...,begin=-1) will get the last
element of every array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the source of the slice.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the new field that is generated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>begin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the beginning of the slice (inclusive).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.expression.IndexValue">IndexValue</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the end of the slice (exclusive).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<span title="struct2tensor.expression.IndexValue">IndexValue</span>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>An Expression object representing the result of the operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="k">def</span><span class="w"> </span><span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>          <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>          <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>          <span class="n">begin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>          <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="w">  </span><span class="sd">"""Creates a slice copy of source_path at new_field_path.</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">  Note that if begin or end is negative, it is considered relative to</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">  the size of the array. e.g., slice(...,begin=-1) will get the last</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">  element of every array.</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">  Args:</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    source_path: the source of the slice.</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    new_field_name: the new field that is generated.</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    begin: the beginning of the slice (inclusive).</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    end: the end of the slice (exclusive).</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">    An Expression object representing the result of the operation.</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">  """</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a>  <span class="k">return</span> <span class="n">slice_expression</span><span class="o">.</span><span class="n">slice_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a>                                           <span class="n">path</span><span class="o">.</span><span class="n">create_path</span><span class="p">(</span><span class="n">source_path</span><span class="p">),</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a>                                           <span class="n">new_field_name</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h8 id="struct2tensor.expression_impl.size.SizeExpression.truncate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">truncate</span>


<a href="#struct2tensor.expression_impl.size.SizeExpression.truncate" class="headerlink" title="Permanent link">¶</a></h8>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">truncate</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><span title="struct2tensor.expression.CoercableToPath">CoercableToPath</span></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">limit</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Union" href="https://docs.python.org/3/library/typing.html#typing.Union">Union</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><span title="tensorflow.Tensor">Tensor</span></span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a truncated copy of source_path at new_field_path.</p>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="k">def</span><span class="w"> </span><span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">CoercableToPath</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>             <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Expression"</span><span class="p">:</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="w">  </span><span class="sd">"""Creates a truncated copy of source_path at new_field_path."""</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h5 id="struct2tensor.expression_impl.size-functions">Functions<a href="#struct2tensor.expression_impl.size-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.size.has" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">has</span>


<a href="#struct2tensor.expression_impl.size.has" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">has</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the has of a field as a new sibling field.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the source path to measure. Cannot be root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the sibling field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="k">def</span><span class="w"> </span><span class="nf">has</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="w">  </span><span class="sd">"""Get the has of a field as a new sibling field.</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">  Args:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    root: the original expression.</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    source_path: the source path to measure. Cannot be root.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    new_field_name: the name of the sibling field.</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    The new expression.</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">  """</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>  <span class="n">new_root</span><span class="p">,</span> <span class="n">size_p</span> <span class="o">=</span> <span class="n">size_anonymous</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">source_path</span><span class="p">)</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>  <span class="c1"># TODO(martinz): consider using copy_over to "remove" the size field</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>  <span class="c1"># from the result.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>  <span class="k">return</span> <span class="n">map_values</span><span class="o">.</span><span class="n">map_values</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>      <span class="n">new_root</span><span class="p">,</span> <span class="n">size_p</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)),</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>      <span class="n">tf</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.size.size" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">size</span>


<a href="#struct2tensor.expression_impl.size.size" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">size</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the size of a field as a new sibling field.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the source path to measure. Cannot be root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the sibling field.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>         <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">  </span><span class="sd">"""Get the size of a field as a new sibling field.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">  Args:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    root: the original expression.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    source_path: the source path to measure. Cannot be root.</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    new_field_name: the name of the sibling field.</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    The new expression.</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">  """</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>  <span class="k">return</span> <span class="n">_size_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">new_field_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.size.size_anonymous" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">size_anonymous</span>


<a href="#struct2tensor.expression_impl.size.size_anonymous" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">size_anonymous</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">root</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the size of a field, and store it as an anonymous sibling.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original expression.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the source path to measure. Cannot be root.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a>, <a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The new expression and the new field as a pair.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/size.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="k">def</span><span class="w"> </span><span class="nf">size_anonymous</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">source_path</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">  </span><span class="sd">"""Calculate the size of a field, and store it as an anonymous sibling.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">  Args:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    root: the original expression.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    source_path: the source path to measure. Cannot be root.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    The new expression and the new field as a pair.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">  """</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>  <span class="k">return</span> <span class="n">_size_impl</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">source_path</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">get_anonymous_field</span><span class="p">())</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.size-modules">Modules<a href="#struct2tensor.expression_impl.size-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="struct2tensor.expression_impl.slice_expression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">slice_expression</span>


<a href="#struct2tensor.expression_impl.slice_expression" class="headerlink" title="Permanent link">¶</a></h4>

    <div class="doc doc-contents ">

        <p>Implementation of slice.</p>
<p>The slice operation is meant to replicate the slicing of a list in python.</p>
<p>Slicing a list in python is done by specifying a beginning and ending.
The resulting list consists of all elements in the range.</p>
<p>For example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">,</span> <span class="s1">'e'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># all elements between index 2 inclusive and index 5 exclusive</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">[</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">,</span> <span class="s1">'e'</span><span class="p">]</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="c1"># all elements between index 2 and the end.</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">[</span><span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">,</span> <span class="s1">'e'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span> <span class="c1"># all elements between the beginning and index 4 (exclusive).</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">]</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># all elements starting three from the end.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="o">&gt;&gt;&gt;</span>                 <span class="c1"># until one from the end (exclusive).</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">[</span><span class="s1">'e'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">]</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="c1"># all elements starting three from the end</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>                   <span class="c1"># until index 6 exclusive.</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">[</span><span class="s1">'e'</span><span class="p">,</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">]</span>
</span></code></pre></div>
<p>TODO(martinz): there is a third argument to slice, which allows one to step
over the elements (e.g. x[2:6:2]=['c', 'e'], giving you every other element.
This is not implemented.</p>
<p>A prensor can be considered to be interleaved lists and dictionaries.
E.g.:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">my_expression</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  <span class="s2">"foo"</span><span class="p">:[</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="p">{</span><span class="s2">"bar"</span><span class="p">:[</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]},</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"d"</span><span class="p">,</span><span class="s2">"e"</span><span class="p">,</span><span class="s2">"f"</span><span class="p">]}</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>      <span class="p">]</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="p">},</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="p">{</span><span class="s2">"bar"</span><span class="p">:[</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"g"</span><span class="p">,</span><span class="s2">"h"</span><span class="p">,</span><span class="s2">"i"</span><span class="p">]},</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"j"</span><span class="p">,</span><span class="s2">"k"</span><span class="p">,</span><span class="s2">"l"</span><span class="p">,</span> <span class="p">]}</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"m"</span><span class="p">]}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="p">]</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="p">}]</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="p">}]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">result_1</span> <span class="o">=</span> <span class="n">slice_expression</span><span class="o">.</span><span class="n">slice_expression</span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>  <span class="n">my_expression</span><span class="p">,</span> <span class="s2">"foo.bar"</span><span class="p">,</span> <span class="s2">"new_bar"</span><span class="p">,</span><span class="n">begin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">result_1</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>  <span class="s2">"foo"</span><span class="p">:[</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="p">{</span><span class="s2">"bar"</span><span class="p">:[</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]},</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"d"</span><span class="p">,</span><span class="s2">"e"</span><span class="p">,</span><span class="s2">"f"</span><span class="p">]}</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>      <span class="p">],</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>     <span class="s2">"new_bar"</span><span class="p">:[</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"d"</span><span class="p">,</span><span class="s2">"e"</span><span class="p">,</span><span class="s2">"f"</span><span class="p">]}</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>      <span class="p">]</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="p">},</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="p">{</span><span class="s2">"bar"</span><span class="p">:[</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"g"</span><span class="p">,</span><span class="s2">"h"</span><span class="p">,</span><span class="s2">"i"</span><span class="p">]},</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"j"</span><span class="p">,</span><span class="s2">"k"</span><span class="p">,</span><span class="s2">"l"</span><span class="p">,</span> <span class="p">]}</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"m"</span><span class="p">,</span> <span class="p">]}</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>     <span class="p">],</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="s2">"new_bar"</span><span class="p">:[</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"j"</span><span class="p">,</span><span class="s2">"k"</span><span class="p">,</span><span class="s2">"l"</span><span class="p">,</span> <span class="p">]}</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"m"</span><span class="p">,</span> <span class="p">]}</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="p">]</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    <span class="p">}]</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="p">}]</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">result_2</span> <span class="o">=</span> <span class="n">slice_expression</span><span class="o">.</span><span class="n">slice_expression</span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  <span class="n">my_expression</span><span class="p">,</span> <span class="s2">"foo.bar.baz"</span><span class="p">,</span> <span class="s2">"new_baz"</span><span class="p">,</span><span class="n">begin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">result_2</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  <span class="s2">"foo"</span><span class="p">:[</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="p">{</span><span class="s2">"bar"</span><span class="p">:[</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">],</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>       <span class="s2">"new_baz"</span><span class="p">:[</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">],</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>      <span class="p">},</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"d"</span><span class="p">,</span><span class="s2">"e"</span><span class="p">,</span><span class="s2">"f"</span><span class="p">],</span> <span class="s2">"new_baz"</span><span class="p">:[</span><span class="s2">"e"</span><span class="p">,</span><span class="s2">"f"</span><span class="p">]}</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>      <span class="p">]</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="p">},</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="p">{</span><span class="s2">"bar"</span><span class="p">:[</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"g"</span><span class="p">,</span><span class="s2">"h"</span><span class="p">,</span><span class="s2">"i"</span><span class="p">],</span> <span class="s2">"new_baz"</span><span class="p">:[</span><span class="s2">"h"</span><span class="p">,</span><span class="s2">"i"</span><span class="p">]},</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"j"</span><span class="p">,</span><span class="s2">"k"</span><span class="p">,</span><span class="s2">"l"</span><span class="p">],</span> <span class="s2">"new_baz"</span><span class="p">:[</span><span class="s2">"k"</span><span class="p">,</span><span class="s2">"l"</span><span class="p">]},</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>      <span class="p">{</span><span class="s2">"baz"</span><span class="p">:[</span><span class="s2">"m"</span><span class="p">,</span> <span class="p">]}</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>      <span class="p">]</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>    <span class="p">}]</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="p">}]</span>
</span></code></pre></div>










<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="            slice_expression (struct2tensor.expression_impl.slice_expression.slice_expression)" href="#struct2tensor.expression_impl.slice_expression.slice_expression">slice_expression</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Creates a new subtree with a sliced expression.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">ATTRIBUTE</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="            IndexValue


  
      module-attribute
   (struct2tensor.expression_impl.slice_expression.IndexValue)" href="#struct2tensor.expression_impl.slice_expression.IndexValue">IndexValue</a></code></td>
            <td class="doc-attribute-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>



  <div class="doc doc-children">





<h5 id="struct2tensor.expression_impl.slice_expression-attributes">Attributes<a href="#struct2tensor.expression_impl.slice_expression-attributes" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="struct2tensor.expression_impl.slice_expression.IndexValue" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">IndexValue</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#struct2tensor.expression_impl.slice_expression.IndexValue" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">IndexValue</span> <span class="o">=</span> <span class="n"><span title="struct2tensor.expression.IndexValue">IndexValue</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<h5 id="struct2tensor.expression_impl.slice_expression-functions">Functions<a href="#struct2tensor.expression_impl.slice_expression-functions" class="headerlink" title="Permanent link">¶</a></h5>

<div class="doc doc-object doc-function">


<h6 id="struct2tensor.expression_impl.slice_expression.slice_expression" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">slice_expression</span>


<a href="#struct2tensor.expression_impl.slice_expression.slice_expression" class="headerlink" title="Permanent link">¶</a></h6>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">slice_expression</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">expr</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">p</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">new_field_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">begin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            IndexValue


  
      module-attribute
   (struct2tensor.expression_impl.slice_expression.IndexValue)" href="#struct2tensor.expression_impl.slice_expression.IndexValue">IndexValue</a></span><span class="p">],</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">end</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="            IndexValue


  
      module-attribute
   (struct2tensor.expression_impl.slice_expression.IndexValue)" href="#struct2tensor.expression_impl.slice_expression.IndexValue">IndexValue</a></span><span class="p">],</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a new subtree with a sliced expression.</p>
<p>This follows the pattern of python slice() method.
See module-level comments for examples.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the original root expression</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the path to the source to be sliced.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Path (struct2tensor.path.Path)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Path">Path</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_field_name</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the name of the new subtree.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="            Step


  
      module-attribute
   (struct2tensor.path.Step)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Step">Step</a></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>begin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>beginning index</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="            IndexValue


  
      module-attribute
   (struct2tensor.expression_impl.slice_expression.IndexValue)" href="#struct2tensor.expression_impl.slice_expression.IndexValue">IndexValue</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>end index.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-internal" title="            IndexValue


  
      module-attribute
   (struct2tensor.expression_impl.slice_expression.IndexValue)" href="#struct2tensor.expression_impl.slice_expression.IndexValue">IndexValue</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="            Expression (struct2tensor.expression.Expression)" href="../../s2t/s2t/#struct2tensor.struct2tensor.Expression">Expression</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A new root expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>struct2tensor/expression_impl/slice_expression.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="k">def</span><span class="w"> </span><span class="nf">slice_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>                     <span class="n">new_field_name</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">Step</span><span class="p">,</span> <span class="n">begin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">],</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                     <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IndexValue</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">expression</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">  </span><span class="sd">"""Creates a new subtree with a sliced expression.</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">  This follows the pattern of python slice() method.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">  See module-level comments for examples.</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">  Args:</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    expr: the original root expression</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    p: the path to the source to be sliced.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    new_field_name: the name of the new subtree.</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    begin: beginning index</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    end: end index.</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">  Returns:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    A new root expression.</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">  """</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>  <span class="n">work_expr</span><span class="p">,</span> <span class="n">mask_anonymous_path</span> <span class="o">=</span> <span class="n">_get_slice_mask</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>  <span class="n">work_expr</span> <span class="o">=</span> <span class="n">filter_expression</span><span class="o">.</span><span class="n">filter_by_sibling</span><span class="p">(</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>      <span class="n">work_expr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mask_anonymous_path</span><span class="o">.</span><span class="n">field_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>  <span class="n">new_path</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_parent</span><span class="p">()</span><span class="o">.</span><span class="n">get_child</span><span class="p">(</span><span class="n">new_field_name</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>  <span class="c1"># We created a lot of anonymous fields and intermediate expressions. Just grab</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>  <span class="c1"># the final result (and its children).</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>  <span class="k">return</span> <span class="n">expression_add</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">{</span><span class="n">new_path</span><span class="p">:</span> <span class="n">work_expr</span><span class="p">})</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>
<h5 id="struct2tensor.expression_impl.slice_expression-modules">Modules<a href="#struct2tensor.expression_impl.slice_expression-modules" class="headerlink" title="Permanent link">¶</a></h5>


  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy", "content.code.select", "content.action.edit"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>